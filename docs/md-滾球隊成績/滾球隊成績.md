# æ»¾çƒéšŠæˆç¸¾

```py
import os
import sys
from datetime import datetime
from tkinter import Tk, filedialog, Button
from tkinter import ttk
import fitz  # PyMuPDF
from openpyxl import Workbook

def is_number_like(s):
    try:
        float(s)
        return True
    except ValueError:
        return False

def remove_average_row(ws):
    for row_num, row in enumerate(ws.iter_rows(min_row=1, max_col=1), start=1):
        if row[0].value and 'ç¸½åˆ†' in str(row[0].value):
            for row_to_delete in range(row_num, len(ws['A']) + 1):
                ws.delete_rows(row_num)
            break

def start_conversion(root, start_button, progress_bar, progress_label):
    # ç¦ç”¨æŒ‰éˆ•ä¸¦é¡¯ç¤ºç¦ç”¨æ•ˆæœ
    start_button.config(state="disabled", relief="sunken", text="è½‰æª”ä¸­...")

    # å•Ÿç”¨ tkinter æª”æ¡ˆé¸æ“‡è¦–çª—
    pdf_paths = filedialog.askopenfilenames(
        title="é¸æ“‡ä¸€å€‹æˆ–å¤šå€‹ PDF æª”æ¡ˆ",
        filetypes=[("PDF Files", "*.pdf"), ("All Files", "*.*")]
    )

    if not pdf_paths:
        print("âŒ æ²’æœ‰é¸æ“‡ä»»ä½• PDFï¼Œç¨‹åºçµæŸã€‚")
        start_button.config(state="normal", relief="raised", text="é–‹å§‹è½‰æ›")  # é‡æ–°å•Ÿç”¨æŒ‰éˆ•
        return

    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    output_folder = filedialog.askdirectory(title="é¸æ“‡å„²å­˜çš„è³‡æ–™å¤¾")  # è®“ä½¿ç”¨è€…é¸æ“‡å„²å­˜ä½ç½®

    if not output_folder:
        print("âŒ æ²’æœ‰é¸æ“‡å„²å­˜è³‡æ–™å¤¾ï¼Œç¨‹åºçµæŸã€‚")
        start_button.config(state="normal", relief="raised", text="é–‹å§‹è½‰æ›")  # é‡æ–°å•Ÿç”¨æŒ‰éˆ•
        return

    print("ğŸ“„ é–‹å§‹æ“·å– PDF æ–‡å­—ä¸¦å¯«å…¥ Excel...")

    wb = Workbook()
    sheet_names = []
    subjects = []

    use_tqdm = sys.stdout is not None  # åˆ¤æ–·æ˜¯å¦æœ‰ console

    # æ›´æ–°é€²åº¦æ¢æœ€å¤§å€¼
    progress_bar["maximum"] = len(pdf_paths)

    for idx, pdf_path in enumerate(pdf_paths, start=1):
        try:
            doc = fitz.open(pdf_path)
            sheet_name = f"a{idx}"
            ws = wb.create_sheet(sheet_name)
            row_num = 1

            for page_num in range(len(doc)):
                page = doc.load_page(page_num)
                text = page.get_text().strip()
                lines = text.split('\n')
                for line in lines:
                    ws.cell(row=row_num, column=1, value=line)
                    row_num += 1

            doc.close()

            temp_text = ""
            col_num = 1
            row_num = 1

            for row in ws.iter_rows(min_row=1, max_col=1):
                cell_value = str(row[0].value).strip() if row[0].value is not None else ""
                if is_number_like(cell_value):
                    ws.cell(row=row_num, column=col_num, value=cell_value)
                    col_num += 1
                else:
                    if temp_text:
                        ws.cell(row=row_num, column=1, value=temp_text)
                        row_num += 1
                    temp_text = cell_value
                    col_num = 2

            if temp_text:
                ws.cell(row=row_num, column=1, value=temp_text)

            remove_average_row(ws)

            if ws['A11'].value:
                new_sheet_name = str(ws['A11'].value).strip()
                if new_sheet_name and len(new_sheet_name) <= 31:
                    ws.title = new_sheet_name
                sheet_names.append(ws.title)

            for row in ws.iter_rows(min_row=12, max_col=1):
                cell_value = str(row[0].value).strip() if row[0].value is not None else ""
                if cell_value and cell_value not in subjects:
                    subjects.append(cell_value)

        except Exception as e:
            print(f"âš ï¸ éŒ¯èª¤ï¼šç„¡æ³•è™•ç†æª”æ¡ˆ {pdf_path}ï¼ŒåŸå› ï¼š{e}")

        # æ›´æ–°é€²åº¦æ¢ä¸¦é¡¯ç¤ºé€²åº¦
        progress_bar["value"] = idx
        progress_label.config(text=f"é€²åº¦: {idx}/{len(pdf_paths)} æª”æ¡ˆè™•ç†ä¸­...")
        root.update_idletasks()

    if "Sheet" in wb.sheetnames:
        del wb["Sheet"]

    ws_summary = wb.create_sheet("Summary", 0)

    for idx, sheet_name in enumerate(sheet_names, start=2):
        ws_summary.cell(row=idx, column=1, value=sheet_name)

    for idx, subject in enumerate(subjects, start=2):
        ws_summary.cell(row=1, column=idx, value=subject)

    ws_summary.cell(row=1, column=len(subjects) + 2, value="ç¸½åˆ†")
    ws_summary.cell(row=1, column=len(subjects) + 3, value="å¹³å‡")

    for idx, sheet_name in enumerate(sheet_names, start=2):
        student_ws = wb[sheet_name]
        total_score = 0
        total_weight = 0

        for i, subject in enumerate(subjects, start=2):
            subject_row = None
            for row in student_ws.iter_rows(min_row=12, max_col=1):
                if row[0].value == subject:
                    subject_row = row[0].row
                    break

            if subject_row:
                score = student_ws.cell(row=subject_row, column=2).value
                weight = student_ws.cell(row=subject_row, column=3).value
                if score is not None and weight is not None and is_number_like(str(score)) and is_number_like(str(weight)):
                    score = float(score)
                    weight = float(weight)
                    total_score += score * weight
                    total_weight += weight
                    ws_summary.cell(row=idx, column=i, value=score)

        if total_weight > 0:
            average_score = total_score / total_weight
            ws_summary.cell(row=idx, column=len(subjects) + 2, value=total_score)
            ws_summary.cell(row=idx, column=len(subjects) + 3, value=average_score)

    final_excel_path = os.path.join(output_folder, f"æ»¾çƒéšŠæˆç¸¾_{timestamp}.xlsx")
    wb.save(final_excel_path)

    print(f"âœ… æ‰€æœ‰ PDF å·²è½‰æˆ Excel ä¸¦æ•´ç†å®Œç•¢ï¼Œå„²å­˜æ–¼ï¼š{final_excel_path}")

    # è½‰æª”å®Œæˆå¾Œé‡æ–°å•Ÿç”¨æŒ‰éˆ•
    start_button.config(state="normal", relief="raised", text="é–‹å§‹è½‰æ›")
    progress_label.config(text="è½‰æª”å®Œæˆï¼")

def create_gui():
    # è¨­ç½® Tkinter è¦–çª—
    window = Tk()
    window.title("PDF è½‰ Excel å·¥å…·")
    window.geometry("400x200")

    # è¨­ç½®æŒ‰éˆ•ä¾†å•Ÿå‹•è½‰æ›
    start_button = Button(window, text="é–‹å§‹è½‰æ›", command=lambda: start_conversion(window, start_button, progress_bar, progress_label), height=2, width=20)
    start_button.pack(pady=20)

    # è¨­ç½®é€²åº¦æ¢
    progress_bar = ttk.Progressbar(window, length=300, mode="determinate")
    progress_bar.pack(pady=10)

    # é¡¯ç¤ºé€²åº¦çš„æ¨™ç±¤
    progress_label = ttk.Label(window, text="é€²åº¦: 0/0 æª”æ¡ˆè™•ç†ä¸­...")
    progress_label.pack()

    # é–‹å§‹ Tkinter ä»‹é¢çš„å¾ªç’°ï¼Œç›´åˆ°è¦–çª—é—œé–‰
    window.mainloop()

if __name__ == "__main__":
    create_gui()


```




<style>
.md-tabs {
    display: none;
}
.md-header {
    display: none;
}
.md-banner {
    display: none;
}
.sponsorship {
    display: none;
}
.md-footer {
    display: none;
}
.md-ellipsis {
    display: none;
}

</style>



