# æ¨¹è«–


## é¡Œå‹æ•´ç†

1. è¨ˆç®—æ¯å€‹é»åˆ°æ¯å€‹é»ä¹‹é–“è·é›¢  
[a129: P_8_3 è³¼ç‰©ä¸­å¿ƒé¸ä½ç½®](#a129-p_8_3-è³¼ç‰©ä¸­å¿ƒé¸ä½ç½®)       
[a223: Q_8_6 æ¨¹ç‹€åœ–çš„è·é›¢ç¸½å’Œ](#a223-q_8_6-æ¨¹ç‹€åœ–çš„è·é›¢ç¸½å’Œ)       
2. ç”±ä¸‹å¾€ä¸Šè¨ˆç®—(bottom-up)         
[a078: P_3_1 æ¨¹çš„é«˜åº¦èˆ‡æ ¹ (bottom-up) (APCS201710)](#a078-p_3_1-æ¨¹çš„é«˜åº¦èˆ‡æ ¹-bottom-up-apcs201710)       
3. æ ¹ç¯€é»æ¯”å¤§å°         
[a131: P_8_5 è‡ªå‹•åˆ†è£ (APCS202002)](#a131-p_8_5-è‡ªå‹•åˆ†è£-apcs202002)       
4. é™£åˆ—å‚³éï¼Œè¨ˆç®—æ¥µå€¼         
[a132: P_8_7 å¯¶çŸ³çš„é¡è‰² (108å…¨åœ‹é«˜ä¸­è³½)](#a132-p_8_7-å¯¶çŸ³çš„é¡è‰²-108å…¨åœ‹é«˜ä¸­è³½)       
5. ä¸ç›¸é„°DP         
[a133: P_8_8 æ¨¹çš„æœ€å¤§ç¨ç«‹é›†](#a133-p_8_8-æ¨¹çš„æœ€å¤§ç¨ç«‹é›†)       
[a224: Q_8_9 æœå‹™ä¸­å¿ƒé¸ä½ç½®](#a224-q_8_9-æœå‹™ä¸­å¿ƒé¸ä½ç½®)       
[a225: Q_8_10 ç«Šè½é–“è«œç¶²](#a225-q_8_10-ç«Šè½é–“è«œç¶²)       
6. èƒŒåŒ…å•é¡ŒDP                    
[a134: P_8_11 å…¬å¸æ´¾å° (NCPC)](#a134-p_8_11-å…¬å¸æ´¾å°-ncpc)ï¼šçµ„åˆã€é¸ä¸€å€‹â†’å€’åº(bottom-up)           
[a144: Q_8_12 ä½”é ˜é€£çºŒçš„åŸé®](#a144-q_8_12-ä½”é ˜é€£çºŒçš„åŸé®)ï¼šbottom-upï¼Œé€£çºŒå…ƒç´ çš„å’Œ        
7. æœ‰å¤ é›£(DP)           
[a135: P_8_13 ä¸åŒæˆæœ¬çš„è³¼ç‰©ä¸­å¿ƒ (@@)](#a135-p_8_13-ä¸åŒæˆæœ¬çš„è³¼ç‰©ä¸­å¿ƒ-)           
[a142: Q_8_16.ç—…æ¯’æ¼”åŒ– (APCS202007)](#a142-q_8_16ç—…æ¯’æ¼”åŒ–-apcs202007)        
8. ç›´å¾‘å•é¡Œ ã€farthest of farthest æ¼”ç®—æ³•ã€‘        
[a060: 201603_q4 è¡€ç·£é—œä¿‚](#a060-201603_q4-è¡€ç·£é—œä¿‚)           
[a143: Q_8_15 æ¨¹ä¸Šä¸€ä½ä¸å›å®¶çš„æ¨éŠ·å“¡](#a143-q_8_15-æ¨¹ä¸Šä¸€ä½ä¸å›å®¶çš„æ¨éŠ·å“¡)   


>æ¨¹çš„DPè‹¥åœ¨ä¸€å€‹é»æœ‰ä¸åŒå‰‡æ–¹å¼(ä¾‹å¦‚ç¯€é»1å¯ä»¥æ”¾ç½®Aã€Bã€Cã€D)ç›´æ¥è¨­ç½®å¤šç¶­é™£åˆ—ï¼Œå¦‚ï¼šdp[i][j]=ç¯€é»ié¸æ“‡æ”¾ç½®jå‹æ…‹ï¼Œä¾‹é¡Œå¦‚[a142: Q_8_16.ç—…æ¯’æ¼”åŒ– (APCS202007)](#a142-q_8_16ç—…æ¯’æ¼”åŒ–-apcs202007)







## æ¨¹ç°¡ä»‹ 

https://web.ntnu.edu.tw/~algo/Tree.html

https://tioj.ck.tp.edu.tw/uploads/attachment/5/13/3.pdf

æ¨¹æ²’æœ‰ç’°ï¼Œæ‰€ä»¥ç›¸è¼ƒæ–¼æœ‰ç’°çš„åœ–ç°¡å–®å¾ˆå¤šã€‚åŒæ™‚ï¼Œä¹Ÿå¤šå‡ºäº†å¾ˆå¤šæ€§è³ªå¯ä»¥åˆ©ç”¨ã€‚æ¨¹çš„
å¹¾å€‹æ€§è³ªåˆ—èˆ‰å¦‚ä¸‹ï¼š
1. é€£é€šä¸”é‚Šæ•¸ç­‰æ–¼é»æ•¸æ¸›ä¸€ã€‚
2. ä»»æ„å…©å€‹é»ä¹‹é–“å­˜åœ¨å”¯ä¸€çš„ç°¡å–®è·¯å¾‘ã€‚
3. é€£é€šï¼Œä½†å»æ‰ä»»æ„ä¸€æ¢é‚Šå°±ä¸é€£é€šã€‚
4. æ²’æœ‰ç’°ï¼Œä½†åŠ ä¸Šä»»æ„ä¸€æ¢é‚Šå°±æœ‰ç’°ã€‚
ã€€ã€€ä»¥ä¸Šå››å€‹æ€§è³ªæ˜¯ç­‰åƒ¹çš„ã€‚é€™ä¹Ÿæ˜¯åˆ¤æ–·ä¸€å€‹åœ–æ˜¯ä¸æ˜¯æ¨¹çš„æ–¹æ³•ã€‚
  
## åŸºæœ¬æ€§è³ª
ã€€ã€€åœ¨æ­¤å…ˆä»‹ç´¹å¹¾å€‹åŸºæœ¬çš„ã€å°ˆå±¬æ–¼æ¨¹çš„è¡“èªï¼ˆæ¨¹èªï¼Ÿï¼‰ï¼š      
1. æ ¹ï¼ˆrootï¼‰ï¼šåœ¨ä¸€å€‹æ¨¹ä¸Šå¯ä»¥é¸å®šä¸€å€‹é»åšç‚ºã€Œæ ¹ã€ã€‚æœ‰é™å®šæ ¹çš„æ¨¹ç¨±ç‚ºã€Œæœ‰æ ¹æ¨¹ã€ã€‚      
2. è‘‰ï¼ˆleafï¼‰ï¼šç„¡æ ¹æ¨¹ä¸­ï¼Œåº¦æ•¸ç‚º1çš„é»ç¨±ç‚ºã€Œè‘‰ã€ï¼›æœ‰æ ¹æ¨¹ä¸­ï¼Œåº¦æ•¸ç‚º1ä¸”éæ ¹çš„é»ç¨±ç‚º      
ã€Œè‘‰ã€ï¼Œä½†åªæœ‰ä¸€å€‹é»çš„æƒ…æ³ï¼Œæ ¹ä¹Ÿæ˜¯è‘‰ã€‚      
3. å­æ¨¹ï¼ˆsubtreeï¼‰ï¼šç§»é™¤ä¸€å€‹é»ä¹‹å¾Œï¼ŒåŸæ¨¹æœƒè¢«åˆ‡å‰²æˆå¾ˆå¤šæ£µæ¨¹ï¼Œç¨±ç‚ºå­æ¨¹ã€‚åœ¨æœ‰æ ¹æ¨¹ä¸­ï¼Œ      
å­æ¨¹é€šå¸¸æŒ‡é é›¢æ ¹çš„é‚£äº›æ¨¹ã€‚      
4. çˆ¶ã€å­é—œä¿‚ï¼ˆparent,childï¼‰ï¼šæœ‰æ ¹æ¨¹ä¸­ï¼Œå¦‚æœvi,vj ç›¸é„°ï¼Œä¸”vi æ¯”è¼ƒæ¥è¿‘æ ¹ï¼Œç¨±vi æ˜¯vj      
çš„çˆ¶è¦ªã€vj æ˜¯viçš„å…’å­ã€‚      
5. ç¥–å…ˆã€å¾Œä»£é—œä¿‚ï¼ˆancestor,descendantï¼‰ï¼šä¸€å€‹é»çš„å°å­©ã€å°å­©çš„å°å­©â‹¯â‹¯ç­‰ç­‰çš†ç¨±ç‚ºå…¶      
ã€Œå¾Œä»£ã€ï¼›ä¸€å€‹é»çš„çˆ¶è¦ªã€çˆ¶è¦ªçš„çˆ¶è¦ªâ‹¯â‹¯ç­‰ç­‰çš†ç¨±ç‚ºå…¶ã€Œç¥–å…ˆã€ã€‚      
6. è·é›¢ï¼ˆdistanceï¼‰ï¼šå…©é»é–“çš„è·é›¢æ˜¯å®ƒå€‘ä¹‹é–“è·¯å¾‘çš„é‚Šæ•¸ï¼Œæˆ–è€…æ˜¯è·¯å¾‘ä¸Šé‚Šæ¬Šçš„åŠ ç¸½ã€‚      
7. æ·±åº¦ï¼ˆdepthï¼‰ï¼šæœ‰æ ¹æ¨¹ä¸­ï¼Œä¸€å€‹é»çš„æ·±åº¦æ˜¯å®ƒåˆ°æ ¹çš„è·é›¢ç¨±ç‚ºæ·±åº¦ã€‚      
8. é«˜åº¦ï¼ˆheightï¼‰ï¼šæœ‰æ ¹æ¨¹ä¸­ï¼Œä¸€å€‹é»åˆ°èˆ‡å®ƒè·é›¢æœ€å¤§çš„è‘‰çš„è·é›¢ç¨±ç‚ºé«˜åº¦ã€‚æ ¹çš„é«˜åº¦ç¨±ç‚ºé€™æ•´é¡†æ¨¹çš„é«˜åº¦ã€‚      

åˆ¤æ–·çˆ¶å­é—œä¿‚ã€ç¥–å…ˆå¾Œä»£é—œä¿‚å¯ä»¥ç”¨ä¸€æ¬¡çš„DFSé è™•ç†ï¼Œå³å¯é”åˆ°O(1)æŸ¥è©¢ã€‚çˆ¶å­      
é—œä¿‚åªè¦å°æ¯å€‹é»è¨˜éŒ„å®ƒçš„çˆ¶è¦ªæ˜¯èª°å³å¯ï¼›ç¥–å…ˆå¾Œä»£é—œä¿‚å‰‡å¯ä»¥åœ¨DFSæ™‚è¨˜éŒ„é€²å…¥è©²é»      
å’Œé›¢é–‹è©²é»çš„æ™‚é–“ï¼Œç•¶é»Açš„æ™‚é–“å€é–“è¢«é»Bå®Œå…¨è¦†è“‹ï¼Œå‰‡Aæ˜¯Bçš„å¾Œä»£ã€‚      
è·é›¢ã€æ·±åº¦çš„éƒ¨åˆ†ï¼Œå¯ç”¨ç°¡å–®çš„DFSæ±‚å‡ºä¸€é»åˆ°æ‰€æœ‰é»çš„è·é›¢ã€‚é«˜åº¦çš„è©±ï¼Œå› ç‚ºè‘‰      
å­çš„é«˜åº¦æ˜¯0ï¼Œè€Œä¸€å€‹é»çš„é«˜åº¦ç­‰æ–¼æ‰€æœ‰å­æ¨¹ä¸­é«˜åº¦åŠ é€£å‘å­æ¨¹çš„é‚Šæ¬Šçš„æœ€å¤§å€¼ï¼Œæ‰€ä»¥ç…§      
æ¨£å¯ä»¥ç”¨DFSè§£æ±ºã€‚      
é †å¸¶ä¸€æï¼Œå› ç‚ºæ¨¹æ²’æœ‰ç’°ï¼Œæ‰€ä»¥åœ¨DFSæ™‚ä¸éœ€è¦è¨˜éŒ„ä¸€å€‹é»æœ‰æ²’æœ‰è¢«é€ è¨ªéï¼Œåªè¦      
çŸ¥é“çˆ¶è¦ªæ˜¯å“ªå€‹é»ï¼Œä¸è¦å¾€å›èµ°å³å¯ã€‚      


## è¨ˆç®—å­æ¨¹å¤§å°
 [a129: P_8_3 è³¼ç‰©ä¸­å¿ƒé¸ä½ç½®](#a129-p_8_3-è³¼ç‰©ä¸­å¿ƒé¸ä½ç½®)

## åˆ¤æ–·æ ¹çµé»ã€è‘‰ç¯€é»

åˆ¤æ–·æ ¹ç¯€é»ã€è‘‰ç¯€é»æ–¹æ³•(ä¹‹ä¸€)ï¼šçœ‹å…¥åº¦ã€å‡ºåº¦

## top-downã€button-up

```cpp
for(int i:v[f]){
    //é€²å…¥å­ç¯€é»  top-down
    dfs(i);
    //é›¢é–‹å­ç¯€é»  button-up
}
```

## ç›´å¾‘å•é¡Œ
  
    
ä¸€æ£µæ¨¹çš„ç›´å¾‘å®šç¾©ç‚ºæ¨¹ç•¶ä¸­æœ€é çš„å…©é»é–“çš„ç°¡å–®è·¯å¾‘ï¼›åœ“å¿ƒæ˜¯èƒ½ä½¿æ¨¹é«˜åº¦æœ€å°çš„æ ¹ã€‚  
è¦å¦‚ä½•æ‰¾å‡ºä¸€æ£µæ¨¹çš„ç›´å¾‘å‘¢ï¼Ÿ  
æœ‰ä¸€å€‹å¾ˆç°¡å–®çš„æ–¹æ³•ï¼šå…ˆå¾ä»»æ„ä¸€å€‹é»DFSåˆ°æ·±åº¦æœ€æ·±çš„é»vï¼Œå†å¾vé»DFSåˆ°æœ€é çš„é»uï¼Œå‰‡vã€uçš„ç°¡å–®è·¯å¾‘å³ç‚ºç›´å¾‘ã€‚é€™å€‹æ–¹æ³•çš„æ­£ç¢ºæ€§ä¸é›£è­‰ï¼Œå¯ä»¥è‡ªå·±å˜—è©¦çœ‹çœ‹ã€‚    
ã€€ã€€    


### farthest of farthest æ¼”ç®—æ³•

>GPTï¼š      
>è¨ˆç®—ä¸€æ£µæ¨¹çš„ç›´å¾‘æ˜¯è¨ˆç®—åœ–è«–ä¸­çš„ä¸€å€‹å¸¸è¦‹å•é¡Œã€‚åœ¨é€™è£¡çš„ã€Œæ¨¹ã€æŒ‡çš„æ˜¯ä¸€ç¨®ç‰¹æ®Šçš„åœ–ï¼Œå…¶ä¸­ä»»ä½•å…©å€‹ç¯€é»éƒ½æœ‰ä¸€æ¢å”¯ä¸€çš„è·¯å¾‘é€£æ¥å®ƒå€‘ï¼Œä¸”ä¸å«ä»»ä½•å¾ªç’°ã€‚æ¨¹çš„ç›´å¾‘å®šç¾©ç‚ºæ¨¹ä¸­æ‰€æœ‰ç¯€é»å°çš„æœ€é•·è·é›¢ï¼Œ      å³æœ€é çš„å…©å€‹ç¯€é»ä¹‹é–“çš„è·¯å¾‘é•·åº¦ã€‚      
> è¨ˆç®—æ¨¹çš„ç›´å¾‘é€šå¸¸æœ‰å¹¾ç¨®æ–¹æ³•ï¼Œå…¶ä¸­æœ€å¸¸è¦‹çš„æ˜¯ä½¿ç”¨å…©æ¬¡å»£åº¦å„ªå…ˆæœç´¢ï¼ˆBFSï¼‰ï¼š      
> 
> 1.  **éš¨æ©Ÿé¸æ“‡ä¸€å€‹ç¯€é»**ï¼šå¾æ¨¹ä¸­éš¨æ©Ÿé¸æ“‡ä¸€å€‹ç¯€é» ğ‘£ vã€‚      
>           
> 2.  **ç¬¬ä¸€æ¬¡ BFS**ï¼šå¾ç¯€é» ğ‘£ v é–‹å§‹é€²è¡Œ BFSï¼Œæ‰¾åˆ°è·é›¢ ğ‘£ v æœ€é çš„ç¯€é» ğ‘¢ ã€‚      
>           
> 3.  **ç¬¬äºŒæ¬¡ BFS**ï¼šå¾ç¯€é» ğ‘¢ u é–‹å§‹é€²è¡Œç¬¬äºŒæ¬¡ BFSï¼Œæ‰¾åˆ°è·é›¢ ğ‘¢ æœ€é çš„ç¯€é» ğ‘¤ã€‚      
>           
> 4.  **è¨ˆç®—ç›´å¾‘**ï¼šç¯€é» ğ‘¢ åˆ°ç¯€é» ğ‘¤ çš„è·é›¢å°±æ˜¯æ¨¹çš„ç›´å¾‘ã€‚      
>           
> 
> é€™å€‹æ–¹æ³•ä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ç‚ºå¾ä»»æ„é»å‡ºç™¼ï¼Œæ‰¾åˆ°çš„æœ€é é»ä¸€å®šæ˜¯å¾é€™å€‹é»å‡ºç™¼çš„æœ€é•·è·¯å¾‘ä¸Šçš„ç«¯é»ä¹‹ä¸€ï¼Œå†å¾é€™å€‹ç«¯é»é–‹å§‹æ‰¾æœ€é é»ï¼Œé€™æ¨£ä¿è­‰èƒ½æ‰¾åˆ°æ•´æ£µæ¨¹çš„æœ€é•·è·¯å¾‘ã€‚      
> å¦‚æœéœ€è¦æ›´å…·é«”çš„å¯¦ç¾æˆ–è§£é‡‹ï¼Œéš¨æ™‚å‘Šè¨´æˆ‘ï¼      

      
### [a060: 201603_q4 è¡€ç·£é—œä¿‚](https://zerojudge.tw/ShowProblem?problemid=h032)

<iframe src="https://drive.google.com/file/d/1oO0sJSXeb9vxLrz9AjAvrsnqDtLMqWKz/preview" width="100%" height="1010px"></iframe>





>æ–¹æ³•1ï¼š
>å…ˆè¨ˆç®—å‡ºæ‰€ä»¥ç¯€é»çš„æœ€å¤§æ¨¹æé•·åº¦
>å†å°æ–¼æ¯å€‹é»ï¼Œæ‰¾åˆ°å…©æœ€å¤§æ¨¹æåŠ ç¸½ï¼Œ
ä»¥ä¸‹ç‚ºç¯„ä¾‹ä¸€

![alt text](../images/æ¨¹è«–/image-55.png){width=100%}

/// collapse-code  
```cpp title="æ‰¾æœ€å¤§ã€ç¬¬äºŒå¤§å€¼æ–¹å¼"
#include <bits/stdc++.h>
using namespace std;

int main() {
    int m1=INT_MIN,m2=INT_MIN; // åˆå§‹åŒ–ç‚ºæœ€å°æ•´æ•¸
    int v[7]={1, 2, 5, 3, 4, 6, 7};
    for (int i=0;i<7;i++) {
        if (v[i]>m1) {
            m2=m1; // å°‡ç•¶å‰æœ€å¤§å€¼æ›´æ–°ç‚ºç¬¬äºŒå¤§å€¼
            m1=v[i]; // æ›´æ–°æœ€å¤§å€¼
        } else if(v[i]>m2) {
            m2=v[i]; // æ›´æ–°ç¬¬äºŒå¤§å€¼
        }
    }
    cout<<m1<<" "<<m2<<endl;
    return 0;
}
```
///

/// collapse-code  
```cpp  
#include<bits/stdc++.h>
using namespace std;
#define N int(1e5)+1
#define nn "\n"
vector<int>v[N];
bool visit[N];
int dp[N];
int ans=0;
int dfs(int f){
    visit[f]=true;
    int m1=0,m2=0;
    for(int i:v[f]){
        if(!visit[i]){
            dfs(i);
            dp[f]=max(dp[f],dp[i]);

            if(dp[i]>m1){                //æ‰¾åˆ°å­ç¯€é»ä¸­å…©å€‹æœ€å¤§çš„é•·åº¦
                m2=m1;
                m1=dp[i];
            }
            else if(dp[i]>m2){
                m2=dp[i];
            }
        }
    }
    ans=max(ans,m1+m2);
    dp[f]+=1;
}
int main(){
    //istringstream cin("8 \
0 1 \
0 2 \
0 3 \
7 0 \
1 4 \
1 5 \
3 6 \
");
    //istringstream cin("4 \
0 1 \
0 2 \
2 3");
    int n;
    cin>>n;
    for(int i=0;i<n;i++){
        int x,y;
        cin>>x>>y;
        v[x].push_back(y);
        v[y].push_back(x);
    }
    dfs(0);
    cout<<ans;
}
```
///

>æ–¹æ³•2ï¼š       
>æ¦‚å¿µåŒæ–¹æ³•ä¸€ï¼Œè®Šæ›æ‰¾æœ€å¤§å€¼ã€ç¬¬äºŒå¤§å€¼çš„åˆæ–¹å¼       
>å¦‚ä¸‹ï¼š       
>å‡è¨­æ•¸åˆ—æ˜¯ Sï¼Œpm æ˜¯prefix_maxï¼Œå‰‡æœ€å¤§å…©å€‹å…ƒç´ ä¹‹å’Œå…¶å¯¦å°±æ˜¯max(S[i]+pm(i): for all i)ã€‚       
>æ‰€ä»¥æˆ‘å€‘åªéœ€è¦ä¸€è·¯æƒæä¸¦ç¶­è­·å¥½ç›®å‰çœ‹åˆ°çš„æœ€å¤§å€¼ï¼Œæ¯æ¬¡å°‡ç•¶ä¸‹çœ‹åˆ°çš„å€¼åŠ ä¸Šä»–ä¹‹å‰çš„æœ€å¤§å€¼ç›¸åŠ å³å¯ã€‚       
       
/// collapse-code  
```cpp  
#include <bits/stdc++.h>
using namespace std;

int main() {
    int m1=INT_MIN,m2=INT_MIN;
    int v[7]={1, 2, 5, 3, 4, 6, 7};
    int prefix_max=-INT_MIN;
    int sum,ans=0;
    for (int i=0;i<7;i++) {
        ans=max(ans,v[i]+v[i-1]);  //ans=æœ€å¤§ã€ç¬¬äºŒå¤§ç›¸åŠ 
        v[i]=max(v[i-1],v[i]);  //v[i]ç‚ºprefix_max
    }
    cout<<ans;
    return 0;
}
```
///

/// collapse-code  
```cpp  
#include<bits/stdc++.h>
using namespace std;
#define N int(1e5)+1
#define nn "\n"
vector<int>v[N];
bool visit[N];

int m=0;
int dp[N];
int ans=0;
int dfs(int f){
    visit[f]=true;
    for(int i:v[f]){
        if(!visit[i]){
            dfs(i);
            m=max(m,dp[f]+dp[i]);
            dp[f]=max(dp[i],dp[f]);
        }
    }
    dp[f]+=1;
}
int main(){
    //istringstream cin("8 \
0 1 \
0 2 \
0 3 \
7 0 \
1 4 \
1 5 \
3 6 \
");
    //istringstream cin("4 \
0 1 \
0 2 \
2 3");
    int n;
    cin>>n;
    for(int i=0;i<n;i++){
        int x,y;
        cin>>x>>y;
        v[x].push_back(y);
        v[y].push_back(x);
    }
    dfs(0);
    cout<<m;
}
```
///
     
     
>æ–¹æ³•ä¸‰ï¼š     
>farthest of farthest æ¼”ç®—æ³•     
>å…©æ¬¡DFS     
>ç¬¬ä¸€æ¬¡æ‰¾fçš„æœ€é é»iï¼Œç¬¬äºŒæ¬¡æ‰¾iæœ€é é»k     
     
/// collapse-code  
```cpp  
#include<bits/stdc++.h>
using namespace std;
#define N int(1e5)+1
#define nn "\n"
vector<int>v[N];
bool visit[N];

int m=0;
int d[N];
int mv=-1;
int md=-1;
int ans=0;

int dfs(int f){
    visit[f]=true;
    for(int i:v[f]){
        if(!visit[i]){
            d[i]=d[f]+1;
            if(d[i]>md){
                md=d[i];
                mv=i;
            }
            dfs(i);
        }
    }
}
int main(){
    //istringstream cin("8 \
0 1 \
0 2 \
0 3 \
7 0 \
1 4 \
1 5 \
3 6 \
");
    //istringstream cin("4 \
0 1 \
0 2 \
2 3");
    int n;
    cin>>n;
    for(int i=0;i<n;i++){
        int x,y;
        cin>>x>>y;
        v[x].push_back(y);
        v[y].push_back(x);
    }
    dfs(0);
    md=-1;
    for(int i=0;i<n;i++){
        visit[i]=false;
        d[i]=0;
    }
    dfs(mv);
    cout<<d[mv];
}
```
///

### a143: Q_8_15 æ¨¹ä¸Šä¸€ä½ä¸å›å®¶çš„æ¨éŠ·å“¡
https://judge.tcirc.tw/problem/d115

å…§å®¹
æœ‰ä¸€å€‹æ¨éŠ·å“¡è¦èµ°è¨ª n å€‹åŸå¸‚ã€‚é€™äº›åŸå¸‚ä»¥ (nâˆ’1)æ¢é“è·¯é€£æ¥ï¼Œæ¯æ¢é“è·¯é€£æ¥å…©å€‹ä¸ åŒçš„åŸå¸‚ä¸¦ä¸”é›™å‘å¯ä»¥é€šè¡Œï¼Œè€Œä¸”å·²çŸ¥æ¯ä¸€å€‹åŸå¸‚éƒ½å¯ä»¥åˆ°é”ï¼Œä¸æœƒæœ‰åˆ°é”ä¸äº†çš„ç‹€æ³ã€‚è¼¸å…¥é“è·¯çš„è³‡æ–™ï¼Œè«‹ä½ å¹«æ¨éŠ·å“¡æ‰¾å‡ºä¸€å€‹æœ€çŸ­çš„è·¯å¾‘èµ°è¨ªæ‰€æœ‰çš„åŸå¸‚ï¼Œæ¨éŠ·å“¡å¯ ä»¥å¾ä»»ä½•åŸå¸‚é–‹å§‹ï¼Œä¹Ÿä¸å¿…å›åˆ°é–‹å§‹çš„åŸå¸‚ï¼Œåªè¦æ¯å€‹åŸå¸‚è‡³å°‘åˆ°ä¸€æ¬¡å°±å¯ä»¥ã€‚ èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚å³åœ–ï¼Œæœ‰ 5 å€‹åŸå¸‚ä»¥ 4æ¢é“è·¯é€£æ¥ï¼Œå‡è¨­ æ¯æ¢é“è·¯çš„é•·åº¦éƒ½æ˜¯ 1ã€‚æœ€çŸ­çš„æ‹œè¨ªè·¯å¾‘æ˜¯ (1,0,4,2,4,3)ï¼Œé•·åº¦ç‚º 5ã€‚


![alt text](../images/æ¨¹è«–/image-56.png){width=50%}
    
è¼¸å…¥èªªæ˜    
ç¬¬ä¸€è¡Œæ˜¯æ­£æ•´æ•¸ n    
ï¼Œä»£è¡¨åŸå¸‚çš„æ•¸é‡ï¼ŒåŸå¸‚æ˜¯ä»¥ 0âˆ¼(nâˆ’1)    
 ç·¨è™Ÿï¼Œæ¥ä¸‹ä¾†æœ‰ nâˆ’1    
 è¡Œæ˜¯é“è·¯çš„è³‡æ–™ï¼Œæ¯è¡Œä¸‰å€‹æ•´æ•¸ a,b    
 èˆ‡ w    
ï¼Œä»£è¡¨æ­¤é“ è·¯é€£æ¥åŸå¸‚ a    
 èˆ‡ b    
ï¼Œé“è·¯çš„é•·åº¦æ˜¯ w    
ã€‚n    
 ä¸è¶…é 50000    
ï¼Œæ¯æ¢é“è·¯é•·åº¦æ˜¯ä¸è¶…é 100    
 çš„æ­£æ•´æ•¸ã€‚    
    
è¼¸å‡ºèªªæ˜         
 è¼¸å‡ºæœ€çŸ­çš„æ—…è¡Œè·é›¢ã€‚     
     
ç¯„ä¾‹è¼¸å…¥ #1     
5     
1 0 1     
0 4 1     
2 4 1     
4 3 1     
ç¯„ä¾‹è¼¸å‡º #1     
5     
ç¯„ä¾‹è¼¸å…¥ #2     
3     
1 2 5     
0 2 3     
ç¯„ä¾‹è¼¸å‡º #2     
8     


>æˆ‘å€‘éœ€è¦æ‰¾åˆ°èµ·é»ã€çµ‚é»ï¼Œèµ·é»ã€çµ‚é»é–“è·¯å¾‘åªæœƒè·¯éä¸€æ¬¡ï¼Œå…¶é¤˜è·¯å¾‘æœƒè·¯éå…©æ¬¡ï¼Œå…¨é«”æœ€å°åŒ–è·¯å¾‘ï¼Œå°±æ˜¯æœ€å¤§åŒ–èµ·é»ã€çµ‚é»é–“è·¯å¾‘    
>ä½¿ç”¨æ¬Šé‡ä½œç‚ºè·é›¢ï¼Œæ‰¾å‡ºæœ€å¤§ç›´å¾‘ã€‚    
>å…¨éƒ¨è·¯æ®µé•·åº¦\*2-ç›´å¾‘å³ç‚ºç­”æ¡ˆ    
    
/// collapse-code  
```cpp  
#include <bits/stdc++.h>
using namespace std;
#define N 100000
#define nn "\n"

struct st{
    int x,y;
};

vector<st>v[N];

int vi[N];
int d[N];
int all_w=0;

int dfs(int f){
    vi[f]=true;
    for(st i:v[f]){
        if(!vi[i.x]){
//            cout<<f<<": "<<i.x<<nn;
            d[i.x]=d[f]+i.y;
            dfs(i.x);
        }
    }
}


int main(){
    //istringstream cin("5 \
1 0 1 \
0 4 1 \
2 4 1 \
4 3 1");

    int n;
    cin>>n;
    for(int i=0;i<n-1;i++){
        int x,y,z;
        cin>>x>>y>>z;
        all_w+=z;
        v[x].push_back({y,z});
        v[y].push_back({x,z});
    }
    dfs(0);
    int re=max_element(d,d+n)-d;
    for(int i=0;i<n;i++){
        d[i]=0;
        vi[i]=false;
    }

//    cout<<nn;

    dfs(re);

//    cout<<nn;

    re=max_element(d,d+n)-d;
    cout<<all_w*2-d[re]<<nn;
//    cout<<re;


}
```
///  
## é‡å¿ƒ   
   
å°‡é‡å¿ƒåˆªæ‰å¾Œï¼Œåˆ†å‰²å¾Œè®Šæˆå…©æ£µæ¨¹ï¼Œå…©æ£µæ¨¹ç¸½ç¯€é»ä¸è¶…éç¸½ç¯€é»æ¨¹1/2   
exï¼šn=15ï¼Œåˆ†å‰²å¾Œå…©æ£µæ¨¹ç¯€é»çš†ç‚º7ã€‚(15/2=7.5ï¼Œ7<=7.5)   
   


## åœ“å¿ƒ

æ¨¹çš„åœ“å¿ƒæ˜¯é€™æ¢æœ€é•·è·¯å¾‘ä¸Šçš„ä¸­é–“ç¯€é»ã€‚å¦‚æœç›´å¾‘æ˜¯å¥‡æ•¸é•·åº¦ï¼Œå‰‡åœ“å¿ƒæ˜¯å”¯ä¸€çš„ï¼›å¦‚æœç›´å¾‘æ˜¯å¶æ•¸é•·åº¦ï¼Œå‰‡åœ“å¿ƒæ˜¯å…©å€‹ç›¸é„°çš„ç¯€é»ã€‚

## æ¨¹å£“å¹³

ç”¨é€”ï¼š  
åˆ¤æ–·ç¥–å…ˆ
é…åˆç·šæ®µæ¨¹æ‰¾LCA   

![alt text](../images/æ¨¹è«–/image-1-1.png){width=100%}


æ¨¹å£“å¹³å¯ä»¥æƒ³æ¨£æˆå‰åºã€å¾Œåºçš„çµåˆ(æœ‰æ™‚å€™æœƒåŠ å…¥ä¸­åºï¼Œä¾‹å¦‚é…åˆç·šæ®µæ¨¹æ‰¾LCAæ™‚)ï¼Œç¶“éå‰é¢å’Œå¾Œé¢æ™‚ç´€éŒ„ï¼Œä¸­é–“ä¸ç´€éŒ„ã€‚     
ç´€éŒ„å¾Œå¯ä»¥å¾—åˆ°ä¸€å€‹åºåˆ—ï¼Œä»¥åœ–ç‰‡ç‚ºä¾‹ï¼Œå¯ä»¥ç™¼ç¾è¢«å¤¾åœ¨åŒä¸€å€‹ç¯€é»nä¹‹é–“çš„ç¯€é»ï¼Œçš†ç‚ºnçš„å­ç¯€é»ã€‚    


/// collapse-code  
```cpp  
#include <bits/stdc++.h>
using namespace std;
#define N 100

vector<int>v[N];

void dfs(int f){
    cout<<f<<" ";
    for(int i:v[f]){
        dfs(i);
    }
    cout<<f<<" ";
}

int main(){
    istringstream cin("9 8 \
0 1 \
1 2 \
2 3 \
2 4 \
1 5 \
0 6 \
6 7 \
6 8");
    int n,m;
    cin>>n>>m;
    for(int i=0;i<m;i++){
        int x,y;
        cin>>x>>y;
        v[x].push_back(y);
    }
    dfs(0);
}
```
///

/// html | div.result
```
0 1 2 3 3 4 4 2 5 5 1 6 7 7 8 8 6 0
```
///
## LCA

>from https://hackmd.io/@konchin/ryhgIlhMu


LCA (Lowest Common Ancestor / æœ€è¿‘å…±åŒç¥–å…ˆ)

### ä½•è¬‚ LCA

åœ¨ä¸€å€‹æœ‰æ ¹æ¨¹ (æˆ– DAG) ä¸Šï¼ŒåŒæ™‚æ“æœ‰ $u$, $v$ å…©å€‹é»ä½œç‚ºå¾Œä»£çš„é»å³ç‚º $u$, $v$ å…©é»çš„ $LCA$

å¦‚åœ–

![alt text](../images/æ¨¹è«–/ePU8X5N.png){width=50%}


å¦å¤–è¦æ³¨æ„ï¼Œä¸€å€‹é»æœ¬èº«ä¹Ÿæ˜¯è‡ªå·±çš„ç¥–å…ˆï¼Œæ‰€ä»¥ $LCA(x, v) = x$

### å¦‚ä½•æ±‚LCA

éš¨ä¾¿éƒ½å¯ä»¥æƒ³åˆ° $O(n)$ çš„ä½œæ³•ï¼Œåªè¦DFSéå»å°±å¥½    
å…¶ä¸­ä¸€å€‹å¯è¡Œçš„æ¼”ç®—æ³•å¦‚ä¸‹ï¼Œå‡è¨­æˆ‘å€‘è¦å° $u$, $v$ åšLCA   

å¯ä»¥å°å…¶ä¸­ä¸€å€‹é»ï¼Œå…ˆå‡è¨­æ˜¯ $u$ ä¸€ç›´å¾€ä¸Šæ‰¾ï¼Œç›´åˆ° $u'$ æˆç‚º $v$ çš„ç¥–å…ˆ    

å¦‚åœ–

![alt text](../images/æ¨¹è«–/11LTM0v.png){width=50%}


é»ƒè‰²æ¡†ä»£è¡¨æ˜¯ $v$ çš„ç¥–å…ˆï¼Œç´…è‰²å‰‡æ˜¯å¾€ä¸Šæ‰¾çš„è·¯å¾‘


```cpp  
int LCA(int u, int v) {
	if(isanc(u, v)) return u;  //å¦‚æœuæ˜¯vç¥–å…ˆ
	if(isanc(v, u)) return v;  //å¦‚æœvæ˜¯uç¥–å…ˆ
	while(!isanc(u, v))    //å¦‚æœä¸æ˜¯ç¥–å…ˆï¼Œuå¾€ä¸Šèµ°(uè®Šç‚ºuç¥–å…ˆ)
		u = anc[u];
	return u;
}
```

å…¶ä¸­ isanc æ˜¯ä½¿ç”¨[æ¨¹å£“å¹³](#æ¨¹å£“å¹³)æŠ€å·§ï¼Œç”¨ä¾†åˆ¤æ–·ç¬¬ä¸€å€‹å¼•æ•¸æ˜¯å¦ç‚ºç¬¬äºŒå€‹å¼•æ•¸çš„ç¥–å…ˆ
anc å‰‡æ˜¯ç”¨ä¾†å„²å­˜æ¯å€‹é»çš„çˆ¶ç¯€é»
anc å¾ˆç›´è¦ºï¼ŒDFS å°±æœ‰äº†
isanc å‰‡éœ€è¦å€ŸåŠ©å¦å¤–å…©å€‹é™£åˆ— tin å’Œ tout ä¾†å¯¦ç¾

tinï¼šé€²å…¥é»çš„æ™‚é–“é»
toutï¼šé›¢é–‹é»çš„æ™‚é–“é»

```cpp  
bool isanc(int a, int b) {
	return tin[a] <= tin[b] && tout[a] >= tout[b];  //å¦‚æœaæ¯”bæ—©é€²ï¼Œaæ¯”bæ™šé›¢é–‹ï¼Œå°±æ˜¯ç¥–å…ˆ
}
```



![alt text](../images/æ¨¹è«–/TjudB5C.png){width=50%}



å¾é€™å¼µåœ–å¯ä»¥ç™¼ç¾ï¼Œä¸€å€‹å­æ¨¹çš„æ ¹ç¯€é» tin çš„å€¼éƒ½æœƒå°æ–¼å­ç¯€é» tin çš„å€¼  
æ ¹ç¯€é» tout çš„å€¼éƒ½æœƒå¤§æ–¼å­ç¯€é» tout çš„å€¼  

æ‰€ä»¥åªè¦æœ‰æ¯å€‹é» tin å’Œ tout çš„å€¼å°±å¯ä»¥åˆ¤æ–·å…©å€‹é»æ˜¯å¦ç‚ºå°æ–¹çš„ç¥–å…ˆ

é è™•ç†å…·é«”å¯¦ç¾å¦‚ä¸‹



```cpp title="dfs"
int dfs(int f){
    t++;
    tin[f]=t;//è¨ˆç®—é€²å…¥fé»çš„æ™‚é–“é»
    for(int i:v[f]){
        anc[i]=f;
        dfs(i);
    }
    t++;
    tout[f]=t;//è¨ˆç®—é€€å‡ºfé»çš„æ™‚é–“é»
}
```

å®Œæ•´ç¨‹å¼ç¢¼(é…åˆ[d767. è¡€ç·£é—œä¿‚](#d767-è¡€ç·£é—œä¿‚))ï¼š
/// collapse-code  
```cpp  
#include <bits/stdc++.h>
using namespace std;
#define N 40000
#define nn "\n"

vector<int>v[N];



int dfs(int f);
int lca(int v,int u);
bool isanc(int a, int b);


int anc[N];
int tin[N];
int tout[N];
int t;
int dis[N];


int main(){
//    istringstream cin("7 6 \
2 3 0 \
4 5 0 \
6 7 0 \
0 \
0 \
0 \
0 \
4 5 \
4 2 \
4 4 \
4 3 \
1 7 \
2 3");
    int n,m;
    cin>>n>>m;
    for(int i=1;i<=n;i++){
        int x;
        while(cin>>x && x!=0){
            v[i].push_back(x);
        }
    }
    dfs(1);
    for(int i=0;i<m;i++){
        int x,y;
        cin>>x>>y;
        int LCA=lca(x,y);

        cout<<LCA<<" "<<dis[x]-dis[LCA]+dis[y]-dis[LCA]<<nn;
    }
}
int lca(int u, int v) {
	if(isanc(u, v)) return u;
	if(isanc(v, u)) return v;
	while(!isanc(u, v))
		u = anc[u];
	return u;
}

bool isanc(int a, int b) {
	return tin[a] <= tin[b] && tout[a] >= tout[b];
}

int dfs(int f){


    //è¨ˆç®—é€²å…¥fé»çš„æ™‚é–“é»
    t++;
    tin[f]=t;


    for(int i:v[f]){
        anc[i]=f;
        dis[i]=dis[f]+1;
        dfs(i);
    }
    
    //è¨ˆç®—é€€å‡ºfé»çš„æ™‚é–“é»
    t++;
    tout[f]=t;

}
```
///

/// details |  "NA (score:99%)"
#0: 94% AC (3ms, 1.2MB)     
é€šéæª¢æ¸¬     
#1: 1% AC (3ms, 1.2MB)     
é€šéæª¢æ¸¬     
#2: 1% AC (11ms, 1.3MB)     
é€šéæª¢æ¸¬     
#3: 1% AC (15ms, 1.4MB)     
é€šéæª¢æ¸¬     
#4: 1% AC (2s, 1.7MB)     
é€šéæª¢æ¸¬     
#5: 1% AC (2.2s, 2.3MB)     
é€šéæª¢æ¸¬     
#6: 1% TLE (1s)     
Killed     
/// 
     
     

ç”±æ–¼ä¸€æ¬¡å¾€ä¸Šæ‰¾ä¸€æ ¼ï¼Œæ‰€ä»¥é€™å€‹æ¼”ç®—æ³•çš„æ™‚é–“è¤‡é›œåº¦ç‚º $O(n)$  
ä½†å¾ˆå¯æƒœæœ‰ $O(\log n)$ æ›´å¿«çš„ä½œæ³•ï¼Œæ‰€ä»¥é¡Œç›®ä¸æœƒç°¡å–®çš„æ”¾éä½   
æ‰€ä»¥æ¥ä¸‹ä¾†å°±è¦ä»‹ç´¹å€å¢æ³•


### å€å¢æ³•

æˆ‘å€‘åœ¨æ‰€æœ‰æ­¥é©Ÿä¸­æœ€æ…¢çš„äº‹æƒ…æ˜¯å‘ä¸Šæ‰¾ç¥–å…ˆ     
æ›å¥è©±èªªå°±æ˜¯åœ¨æœå°‹ã€Œç¬¬ä¸€å€‹ç‚ºå…±åŒç¥–å…ˆçš„äººã€ 
æˆ‘å€‘å°‡ä»–ç•«æˆä¸€æ¢ç·š     

![alt text](<../images/æ¨¹è«–/è¢å¹•æ“·å–ç•«é¢ 2024-10-26 160823.png>){width=100%}

æ˜¯ä¸æ˜¯æœ‰ç¨®è«åç†Ÿæ‚‰çš„æ„Ÿè¦º      
å°å°ï¼Œå¯ä»¥ä½¿ç”¨[è·³èºäºŒåˆ†æœ](æœå°‹ã€äºŒåˆ†æœå°‹ã€è·³èºäºŒåˆ†æœ.md#è·³èºäºŒåˆ†æœ)

æˆ‘å€‘å¯ä»¥å¾ç¯€é»8ç‚ºèµ·é»ï¼Œå‘å³é‚Šè·³ï¼Œå¦‚æœå¯ä»¥è·³å°±å¾€å¾Œè·³ï¼Œç›´åˆ°ä¸èƒ½è·³ï¼Œæœ€å¾Œå°±æœƒèµ°åˆ°ç¯€é»3ï¼Œè€Œæˆ‘å€‘çš„ç›®æ¨™å°±æ˜¯3çš„çˆ¶ç¯€é»2

è©²å¦‚ä½•å¯¦ä½œå‘¢?
åœ¨é€™é‚Šæˆ‘å€‘ä¸€æ¨£ç”¨[è·³èºäºŒåˆ†æœ](æœå°‹ã€äºŒåˆ†æœå°‹ã€è·³èºäºŒåˆ†æœ.md#è·³èºäºŒåˆ†æœ)çš„æ¦‚å¿µï¼Œä½†æ˜¯æœ‰é»è®ŠåŒ–ã€‚


å› ç‚ºæˆ‘å€‘æ²’è¾¦æ³•ç›´æ¥åœ¨O(N)å…§è·³èºï¼Œæ‰€ä»¥æˆ‘å€‘è¦å…ˆé è™•ç†ï¼Œè®“æˆ‘å€‘å¯ä»¥æŸ¥è©¢ç¥–å…ˆã€‚  

æ–¼æ˜¯ç™¼å±•å‡ºäº†ä¸€å€‹æ–¹æ³•ï¼šåªè¨˜éŒ„æ¯å€‹ç¯€é»å¾€ä¸Šçš„$2^n (n=0,1,2....)$å€‹ç¥–å…ˆã€‚   
å‡è¨­æˆ‘å€‘åœ¨ä¸Šåœ–ä¸­çš„ç›®æ¨™æ˜¯ $2$ ï¼Œæˆ‘å€‘æœƒç§»å‹•ã€Œ$2^2+2^0=4+1=5$ã€å€‹ä½ç½®ï¼Œå¾ $8$ ç§»å‹• $5$ æ­¥åˆ° $2$



<iframe width="1903" height="742" src="https://www.youtube.com/embed/lh-LX7rZhIU" title="LCA" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

æ­¥é©Ÿå¦‚ä¸‹ï¼Œé…åˆä¸Šé¢å½±ç‰‡(æˆ‘å€‘è¦æ‰¾æœ€å¾Œä¸€å€‹éå…±åŒç¥–å…ˆ $3$)ï¼š  

1. è©¦è©¦çœ‹ $2^3=8$ï¼Œç¯€é» $8$ å¾€ä¸Š $8$ æ˜¯å…±åŒç¥–å…ˆ(root)ï¼Œä¸è·³ã€‚   
2. è©¦è©¦çœ‹ $2^2=4$ï¼Œç¯€é» $8$ å¾€ä¸Š $4$ ä¸æ˜¯å…±åŒç¥–å…ˆ(ç¯€é» $4$)ï¼Œå¯ä»¥è·³ï¼Œæ‰€ä»¥è·³åˆ°ç¯€é» $4$ã€‚    
3. è©¦è©¦çœ‹ $2^1=2$ï¼Œç¯€é» $4$ å¾€ä¸Š $2$ æ˜¯å…±åŒç¥–å…ˆ(ç¯€é» $2$)ï¼Œä¸è·³ã€‚   
4. è©¦è©¦çœ‹ $2^0=1$ï¼Œç¯€é» $4$ å¾€ä¸Š $1$ ä¸æ˜¯å…±åŒç¥–å…ˆ(ç¯€é» $3$)ï¼Œå¯ä»¥è·³ï¼Œæ‰€ä»¥è·³åˆ°ç¯€é» $3$ã€‚      
5. æ²’æœ‰ $2^{-1}$ äº†ï¼Œæ‰€ä»¥æˆ‘å€‘è·³åˆ°äº†ç›®æ¨™ï¼šç¯€é» $3$ã€‚
6. ç¯€é» $3$ çš„ç¥–å…ˆç¯€é» $2$ å°±æ˜¯LACã€‚


æ¥ä¸‹ä¾†æˆ‘å€‘å°±å¯ä»¥å¯¦ä½œè·³èºäºŒåˆ†æœ(å¦‚ä¸‹ç¨‹å¼ç¢¼)ï¼š     

1. ä¸‹é¢çš„nç‚ºç¸½ç¯€é»æ•¸ï¼Œæˆ‘å€‘ç›´æ¥å‡è¨­æ¨¹çš„æœ€å£æƒ…æ³æ˜¯ä¸€æ¢ç·´ï¼Œç¥–å…ˆæœ€å¤šæœƒéœ€è¦å¾€ä¸Šèµ° n-1 æ­¥ã€‚
    ä¹Ÿå°±æ˜¯èªªæˆ‘å€‘å¦‚æœæƒ³è¦æ±‚æœ€å¤šæ­¥æ•¸ $x$ï¼Œ $x$ è¦æ»¿è¶³ $2^x \geq  (n-1)$ ï¼Œå¯ä»¥å¾—åˆ° $x \geq \log_2(n - 1)$ ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘å€‘çš„ä¸Šé™ç‚º $\log_2(n - 1)$ ï¼Œä¹Ÿå¯ä»¥æ‡¶ä¸€é»ä¸æ‰“ã€Œ-1ã€ï¼Œè®Šæˆ $\log_2(n)$  (å¤šè¨ˆç®—ä¸€é»é»)     
2. æˆ‘å€‘ä½¿ç”¨`anc[i][j]`å„²å­˜ã€Œç¯€é» $i$ å¾€ä¸Š $2^j$ æ­¥çš„ç¥–å…ˆç·¨è™Ÿã€ï¼Œå…ˆå…¨éƒ¨å®£å‘Šç‚º $-1$ ä¾†é˜²æ­¢`anc[i][j]`çš„ $j$ è¶…å‡ºç¯„åœã€‚    

```cpp title="è·³èºäºŒåˆ†æœ"
int lca(int a, int b) {
    if (isanc(a, b)) return a;
    if (isanc(b, a)) return b;
    for (int jump = __lg(n); jump >= 0; jump--) // æ‰¾åˆ°æœ€é«˜çš„éå…±åŒç¥–å…ˆ
        if (anc[a][jump] != -1 && !isanc(anc[a][jump], b)) // å¦‚æœæ²’æœ‰è¶…å‡ºç¯„åœï¼Œè€Œä¸”éå…±åŒç¥–å…ˆ(å¯ä»¥è·³)
            a = anc[a][jump];                              //å°±è·³
    return anc[a][0]; //ã€Œæœ€é«˜çš„éå…±åŒç¥–å…ˆã€çš„ç¥–å…ˆå³ç‚ºå…±åŒç¥–å…ˆ
}
```

æ¥ä¸‹ä¾†æˆ‘å€‘è¦æ€è€ƒå¦‚ä½•é å…ˆè™•ç†å¥½æ‰€æœ‰çš„ç¥–å…ˆ`anc[i][j]`  
æˆ‘å€‘å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ€§è³ªï¼š$2^{n}=2^{n-1} \times 2$ ï¼Œä¹Ÿå°±æ˜¯ $2^{n}=2^{n-1} + 2^{n-1}$

![alt text](../images/æ¨¹è«–/åœ–ç‰‡1.jpg){width=100%}

```c++
anc[i][j]=anc[anc[i][j-1]][j-1];
```


æ‰€ä»¥æˆ‘å€‘å¯ä»¥åœ¨dfsæ™‚é †ä¾¿dpæ‰€æœ‰ç¥–å…ˆé—œä¿‚ï¼Œå¦‚ä¸‹ï¼Œä½†æ˜¯è¦æ³¨æ„å¦‚æœ`anc[i][j-1] == -1`å°±ä¸è¦å†dpäº†ï¼Œä¸ç„¶æœƒè®Šæˆï¼šanc[i][j] = anc[-1][j-1]ï¼Œè¶…å‡ºé™£åˆ—ç¯„åœã€‚
```cpp title="dfsæ™‚é †ä¾¿dpæ‰€æœ‰ç¥–å…ˆé—œä¿‚"
void dfs(int f) {
    t++;
    tin[f] = t;
    for (int i : v[f]) {
        // dp æ‰€æœ‰ç¥–å…ˆé—œä¿‚
        anc[i][0] = f; // è¨­å®šç¬¬ä¸€å±¤ç¥–å…ˆ
        for (int j = 1; j <= __lg(n); j++) { // å¾ 1 é–‹å§‹ï¼Œå› ç‚º anc[i][j-1] ä¸­çš„ j-1=0
            if (anc[i][j-1] == -1) break;//å¾€ä¸Šå¤ªå¤šäº†(å¦‚æœæ²’æœ‰åŠ é€™æ¢ä»¶ï¼Œéè¿´å¼å°±æœƒè®Šæˆanc[i][j] = anc[-1][j-1]ï¼Œè¶…å‡ºç¯„åœ)
            anc[i][j] = anc[anc[i][j-1]][j-1];
        }
        dis[i] = dis[f] + 1;
        dfs(i);
    }
    t++;
    tout[f] = t;
}
```


æœ€å¾Œå°±åšå®Œæ‰€æœ‰äº‹æƒ…äº†ï¼Œä»¥ä¸‹ç‚ºå®Œæ•´ç¨‹å¼ç¢¼ã€‚
/// collapse-code  
```cpp title="å®Œæ•´ç¨‹å¼ç¢¼"
#include <bits/stdc++.h>
using namespace std;
#define N 40000
#define nn "\n"

vector<int> v[N];
int n, m;
int tin[N];
int tout[N];
int t;
int dis[N];
vector<vector<int>> anc(N, vector<int>(15, -1)); // åˆå§‹åŒ–ç‚º -1 è¡¨ç¤ºè¶…å‡ºç¯„åœ(ç­‰åŒæ–¼int anc[N][15]ï¼Œå…¨éƒ¨åˆå§‹åŒ–ç‚º-1)

bool isanc(int a, int b) { // åˆ¤æ–· a æ˜¯å¦æ˜¯ b çš„ç¥–å…ˆ
    return tin[a] <= tin[b] && tout[a] >= tout[b];
}

int lca(int a, int b) {
    if (isanc(a, b)) return a;
    if (isanc(b, a)) return b;
    for (int jump = __lg(n); jump >= 0; jump--) // æ‰¾åˆ°æœ€é«˜çš„éå…±åŒç¥–å…ˆ
        if (anc[a][jump] != -1 && !isanc(anc[a][jump], b)) // å¦‚æœæ²’æœ‰è¶…å‡ºç¯„åœï¼Œè€Œä¸”å¯ä»¥è·³
            a = anc[a][jump];                              //å°±è·³
    return anc[a][0]; //ã€Œæœ€é«˜çš„éå…±åŒç¥–å…ˆã€çš„ç¥–å…ˆå³ç‚ºå…±åŒç¥–å…ˆ
}

void dfs(int f) {
    t++;
    tin[f] = t;
    for (int i : v[f]) {
        // dp æ‰€æœ‰ç¥–å…ˆé—œä¿‚
        anc[i][0] = f; // è¨­å®šç¬¬ä¸€å±¤ç¥–å…ˆ
        for (int j = 1; j <= __lg(n); j++) { // å¾ 1 é–‹å§‹ï¼Œå› ç‚º anc[i][j-1] ä¸­çš„ j-1=0
            if (anc[i][j-1] == -1) break;//å¾€ä¸Šå¤ªå¤šäº†(å¦‚æœæ²’æœ‰åŠ é€™æ¢ä»¶ï¼Œéè¿´å¼å°±æœƒè®Šæˆanc[i][j] = anc[-1][j-1]ï¼Œè¶…å‡ºç¯„åœ)
            anc[i][j] = anc[anc[i][j-1]][j-1];
        }
        dis[i] = dis[f] + 1;
        dfs(i);
    }
    t++;
    tout[f] = t;
}

int main() {
    ios::sync_with_stdio(0);
    cin.tie(0);
    // istringstream cin("7 6 \
2 3 0 \
4 5 0 \
6 7 0 \
0 \
0 \
0 \
0 \
4 5 \
4 2 \
4 4 \
4 3 \
1 7 \
2 3");
    cin >> n >> m;
    for (int i = 1; i <= n; i++) {
        int x;
        while (cin >> x && x != 0) {
            v[i].push_back(x);
        }
    }

    dfs(1); // å‡è¨­ root ç‚º 1

    for (int i = 0; i < m; i++) {
        int x, y;
        cin >> x >> y;
        int LCA = lca(x, y);

        cout << LCA << " " << dis[x] - dis[LCA] + dis[y] - dis[LCA] << nn;
    }
}
```
///


### [d767. è¡€ç·£é—œä¿‚](https://zerojudge.tw/ShowProblem?problemid=d767)    
    
å…§å®¹    
çµ¦ä¸€å¼µç¥–è­œ,è©¢å• A , B å…©äººé—œä¿‚æœ€è¿‘çš„å…±åŒç¥–å…ˆ ä»¥åŠ A , B ä¹‹é–“çš„è¦ªç­‰          
example 1    
          
          
![alt text](../images/æ¨¹è«–/image-2.png){width=100%}          
          
          
è¦ªç­‰è¨ˆç®— : å¾€ä¸Šç®—åˆ°èˆ‡è¦è¨ˆç®—çš„äººå…±åŒç¥–å…ˆè™•ï¼Œå†å¾€ä¸‹ç®—åˆ°é‚£å€‹äººï¼Œæ•¸å¤šå°‘å°±æ˜¯å¹¾è¦ªç­‰ã€‚          
          
â€» è¼¸å…¥çš„äººçš„ç·¨è™Ÿï¼Œå¿…ç‚º 1~N ï¼Œè€Œå…’å¥³ç·¨è™Ÿå¿…å¤§æ–¼çˆ¶æ¯æœ¬èº«çš„ç·¨è™Ÿã€‚          
          
          
è¼¸å…¥èªªæ˜          
ç¬¬ä¸€è¡Œå…©å€‹æ•¸å­— N , Q          
åˆ†åˆ¥ä»£è¡¨æ¥ä¸‹ä¾†æœƒæœ‰ N è¡Œæ•¸å­—åˆ†åˆ¥ä»£è¡¨è©²äººçš„å…’å¥³ç·¨è™Ÿ(ä»¥ 0 è¡¨çµæŸ)ï¼Œ          
å†ä¾†æœƒæœ‰ Q è¡Œ          
æ¯è¡Œä¸Šæœƒæœ‰å…©å€‹æ•¸å­— A , B ï¼Œä»£è¡¨è¦æ±‚å‡º A , B å…©äººçš„é—œä¿‚æœ€è¿‘çš„å…±åŒç¥–å…ˆ          
ä»¥åŠ A , B ä¹‹é–“çš„è¦ªç­‰ã€‚          
è©³ç´°è«‹åƒè€ƒSample Inputã€‚          
(Nâ‰¦3,0000,    1â‰¦A,Bâ‰¦N,     Qâ‰¦N2)          
          
è¼¸å‡ºèªªæ˜          
è¼¸å‡ºå…©å€‹æ•¸å­—æœ€è¿‘çš„å…±åŒç¥–å…ˆ ä»¥åŠ A , B ä¹‹é–“çš„è¦ªç­‰          
          
    
```cpp title="ç¯„ä¾‹è¼¸å…¥ #1"
7 6
2 3 0
4 5 0
6 7 0
0
0
0
0
4 5
4 2
4 4
4 3
1 7
2 3
```

```cpp title="ç¯„ä¾‹è¼¸å‡º #1"
2 2
2 1
4 0
1 3
1 2
1 2
```


## è¨ˆç®—é€£é€šå€å¡Šæ•¸é‡


è¦è¨ˆç®—ä¸€å€‹åœ–ä¸­æœ‰å¹¾å€‹é€£é€šå€å¡Š

ç›´æ¥å°æ‰€æœ‰é»dfsï¼Œæœ‰ç¶“éçš„å°±ä¸ç”¨æ‰¾ï¼Œçœ‹å¯ä»¥æ‰¾å¹¾æ¬¡ã€‚
``` cpp
int count=0;
for(int i=0;i<n;i++){
    if(!vis[i]){
        dfs(i);
        count++;
    }
}
```

ä¾‹é¡Œï¼š[æ‰“å¡éŠæˆ²](#2171--æ‰“å¡éŠæˆ²-checkin)




## é¡Œç›®ç·´ç¿’

### P-8-1. æ¨¹ä¸Šçš„æ¨éŠ·å“¡
https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a127

æœ‰ä¸€å€‹æ¨éŠ·å“¡è¦èµ°è¨ªnå€‹åŸå¸‚ä¸¦åœ¨çµæŸå¾Œå›åˆ°å‡ºç™¼çš„åŸå¸‚ã€‚é€™äº›åŸå¸‚ä»¥n-1æ¢é“è·¯é€£æ¥ï¼Œæ¯æ¢é“è·¯é€£æ¥å…©å€‹ä¸åŒçš„åŸå¸‚ä¸¦ä¸”é›™å‘å¯ä»¥é€šè¡Œï¼Œè€Œä¸”å·²çŸ¥æ¯ä¸€å€‹åŸå¸‚éƒ½å¯ä»¥åˆ°é”ï¼Œä¸æœƒæœ‰åˆ°é”ä¸äº†çš„ç‹€æ³ã€‚

è¼¸å…¥é“è·¯çš„è³‡æ–™ï¼Œè«‹ä½ æ‰¾å‡ºä¸€å€‹é•·åº¦æœ€çŸ­çš„ç¨‹å¼èµ°è¨ªé †åºï¼Œå› ç‚ºé€™æ¨£çš„é †åºå¾ˆå¤šï¼Œä½ å¿…é ˆè¼¸å‡ºå­—å…¸é †åºæœ€å°çš„é‚£ä¸€å€‹ã€‚å­—å…¸é †åºæ˜¯ç”¨ä¾†æ¯”è¼ƒå…©å€‹åºåˆ—çš„å…ˆå¾Œé †åºï¼Œå…¶æ–¹æ³•æ˜¯ç”±å‰å¾€å¾Œæ‰¾åˆ°ç¬¬ä¸€å€‹ä¸ç›¸åŒçš„ä½ç½®ï¼Œè©²å…ƒç´ æ¯”è¼ƒå°çš„åºåˆ—å°±æ˜¯é †åºæ¯”è¼ƒå°ï¼Œå¦‚åŒåœ¨è‹±æ–‡å­—å…¸ä¸­å–®å­—çš„é †åºä¸€èˆ¬ã€‚ä¾‹å¦‚ (0,2,3,1)<(0,3,1,2)ï¼Œåˆ(0,3,2,1)<(1,0,2,3)ã€‚

èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚å³åœ–ï¼Œæœ‰5å€‹åŸå¸‚ä»¥4æ¢é“è·¯é€£æ¥ï¼Œå‡è¨­æ¯æ¢é“è·¯çš„é•·åº¦éƒ½æ˜¯1ã€‚å­—å…¸é †åºæœ€å°çš„æœ€çŸ­æ‹œè¨ªé †åºæ˜¯(0,1,0,4,2,4,3,4,0)ã€‚

![alt text](../images/æ¨¹è«–/SkgV4dXNR.png){width=50%}

è¼¸å…¥èªªæ˜     
ç¬¬ä¸€è¡Œæ˜¯æ­£æ•´æ•¸ nï¼Œä»£è¡¨åŸå¸‚çš„æ•¸é‡ï¼ŒåŸå¸‚æ˜¯ä»¥ 0 ~ (n-1) ç·¨è™Ÿã€‚     
æ¥ä¸‹ä¾†æœ‰ (n-1) è¡Œæ˜¯é“è·¯çš„è³‡æ–™ï¼Œæ¯è¡Œä¸‰å€‹æ•´æ•¸ a , b èˆ‡ w ï¼Œä»£è¡¨æ­¤é“è·¯é€£æ¥åŸå¸‚ a èˆ‡ bï¼Œé“è·¯çš„é•·åº¦æ˜¯ wã€‚     
n ä¸è¶…é 50000ï¼Œæ¯æ¢é“è·¯é•·åº¦æ˜¯ä¸è¶…é 100 çš„æ­£æ•´æ•¸ã€‚     
     

è¼¸å‡ºèªªæ˜     
ç¬¬ä¸€è¡Œè¼¸å‡ºæœ€çŸ­çš„æ—…è¡Œè·é›¢ï¼Œç¬¬äºŒè¡Œè¼¸å‡ºæ‹œè¨ªé †åºï¼Œç›¸é„°çš„æ•¸å­—ä¹‹é–“è¦ä»¥ä¸€å€‹ç©ºç™½é–“æ ¼ã€‚     
     
ç¯„ä¾‹è¼¸å…¥ #1     
5     
1 0 1     
0 4 1     
2 4 1     
4 3 1     
     
ç¯„ä¾‹è¼¸å‡º #1     
8     
0 1 0 4 2 4 3 4 0     

ç¯„ä¾‹è¼¸å…¥ #2       
3       
1 2 5       
0 2 3       
       
ç¯„ä¾‹è¼¸å‡º #2       
16       
0 2 1 2 0       
       
/// collapse-code  
```cpp  
#include<bits/stdc++.h>
using namespace std;
#define N 50010
#define nn "\n"
#define nnn " "

vector<pair<int,int>>v[N];

bool visit[N]={false};

int ans1=0;
vector<int>ans2;

int dfs(int f){
    visit[f]=true;
    ans2.push_back(f);
    for(auto i:v[f]){
        if(!visit[i.first]){
            //cout<<i<<nnn;
            ans1+=i.second*2;
            dfs(i.first);
            ans2.push_back(f);
        }
    }
}
int main(){

    //istringstream cin("5 \
1 0 1 \
0 4 1 \
2 4 1 \
4 3 1");
    int n;
    cin>>n;
    for(int i=0;i<n-1;i++){
        int x,y,z;
        cin>>x>>y>>z;
        v[x].push_back({y,z});
        v[y].push_back({x,z});
    }
    for(int i=0;i<n;i++){
        sort(v[i].begin(),v[i].end());
    }
    dfs(0);
    cout<<ans1<<nn;
    for(int i:ans2){
        cout<<i<<" ";
    }
}

```
///

### a128: P\_8\_2 ç‰©æµæ´¾é€ç³»çµ±



Â æœ‰ä¸€å€‹ç‰©æµæ´¾é€ç³»çµ±ï¼Œç³»çµ±æœ‰nå€‹å·¥ä½œç«™èˆ‡n-1æ¢è¼¸é€å¸¶ï¼Œå·¥ä½œç«™ä»¥0~n-1ç·¨è™Ÿï¼Œå…¶ä¸­0è™Ÿç«™æ˜¯é€²è²¨ç«™ï¼Œæ‰€æœ‰ç‰©å“éƒ½æ˜¯ç”±0è™Ÿç«™é€²å…¥ç³»çµ±ç„¶å¾Œç¶“éè¼¸é€å¸¶é…é€åˆ°æŸå€‹ç«™ã€‚æ¯å€‹è¼¸é€å¸¶éƒ½æ˜¯å–®å‘çš„å¾æŸå€‹ç«™aæŠŠç‰©å“é€åˆ°ç«™bï¼Œè¼¸é€çš„æ™‚é–“æ˜¯w(a,b)ã€‚

å·²çŸ¥ç”±é€²è²¨ç«™å¯ä»¥ç¶“ç”±è¼¸é€å¸¶ç›´æ¥æˆ–é–“æ¥è½‰é€åˆ°é”ä»»ä½•å…¶ä»–ç«™ï¼Œè«‹è¨ˆç®—ä¸‹åˆ—å…©è€…       
(1). ç”±é€²è²¨ç«™åˆ°é”é‹é€æ™‚é–“æœ€é•·çš„ç«™éœ€è¦å¤šå°‘æ™‚é–“       
(2). ç”±é€²è²¨ç«™éœ€è¦æœ€å¤šæ¬¡è½‰é‹çš„éœ€è¦ç¶“éå¹¾æ¬¡è¼¸é€å¸¶ã€‚       
èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚å³åœ–ï¼Œæœ‰5å€‹ç«™ä»¥4æ¢è¼¸é€å¸¶é€£æ¥ï¼Œå‡è¨­æ¯æ¢è¼¸é€å¸¶çš„é‹é€æ™‚é–“å¦‚åœ–ä¸Šæ¨™ç¤ºã€‚éœ€è¦æœ€é•·é‹é€çš„æ™‚é–“æ˜¯3è™Ÿç«™(2+4=6)ï¼Œæœ€å¤šéœ€è¦ç¶“éçš„è¼¸é€å¸¶æ˜¯å…©æ¬¡(2è™Ÿç«™èˆ‡3è™Ÿç«™)ã€‚     
     
![alt text](../images/æ¨¹è«–/SkEL6_XNR.png){width=100%}

è¼¸å…¥èªªæ˜     
 ç¬¬ä¸€è¡Œæ˜¯æ­£æ•´æ•¸nï¼Œn>1ï¼Œæ¥ä¸‹ä¾†æœ‰n-1è¡Œæ˜¯è¼¸é€å¸¶çš„è³‡æ–™ï¼Œç¬¬iè¡Œ2å€‹æ•´æ•¸xèˆ‡wï¼Œä»£è¡¨æ­¤è¼¸é€å¸¶é€£æ¥xèˆ‡iï¼Œè¼¸é€çš„æ™‚é–“æ˜¯wã€‚nä¸è¶…é1e5ï¼Œæ¯æ¢è¼¸é€å¸¶çš„è¼¸é€æ™‚é–“æ˜¯ä¸è¶…é1000çš„æ­£æ•´æ•¸ã€‚          
          
è¼¸å‡ºèªªæ˜     
 ç¬¬ä¸€è¡Œè¼¸å‡ºæœ€é•·çš„é‹é€ç¸½æ™‚é–“ï¼Œç¬¬äºŒè¡Œè¼¸å‡ºæœ€å¤šç¶“éå¹¾æ¬¡è¼¸é€å¸¶ã€‚ç¬¬ä¸€è¡Œèˆ‡ç¬¬äºŒè¡Œçš„ç­”æ¡ˆä¸ä¸€å®šæ˜¯åŒä¸€å€‹ç«™ï¼Œé™¤äº†è¼¸é€å¸¶ä»¥å¤–çš„æ™‚é–“å‡å¿½ç•¥ä¸è¨˜ã€‚     
         
ç¯„ä¾‹è¼¸å…¥ 1    
5    
0 5    
4 1    
4 4    
0 2    
ç¯„ä¾‹è¼¸å‡º 1    
6    
2    
ç¯„ä¾‹è¼¸å…¥ 2    
6    
0 9         
0 1     
2 1     
5 3     
3 2     
ç¯„ä¾‹è¼¸å‡º 2     
9     
4     

/// collapse-code  
```cpp  
#include<bits/stdc++.h>
using namespace std;
#define N int(1e5+1)
#define nn "\n"
#define nnn " "
vector<pair<int,int>>v[N];
bool visit[N]={false};
int d[N]={0};
int d1[N]={0};
int ans1=0,ans2=0;
int dfs(int f){
    visit[f]=true;
    for(auto i:v[f]){
        if(!visit[i.first]){
            d[i.first]=d[f]+i.second;
            d1[i.first]=d1[f]+1;
            ans1=max(d[i.first],ans1);
            ans2=max(d1[i.first],ans2);
            dfs(i.first);
        }
    }
}
int main(){

    //istringstream cin("5 \
0 5 \
4 1 \
4 4 \
0 2");

    //istringstream cin("6 \
0 9 \
0 1 \
2 1 \
5 3 \
3 2");
    int n;
    cin>>n;
    for(int i=1;i<=n;i++){
        int y,z;
        cin>>y>>z;
        v[i].push_back({y,z});
        v[y].push_back({i,z});
    }
    dfs(0);
    cout<<ans1<<nn<<ans2;
}

```
///

### a129: P\_8\_3 è³¼ç‰©ä¸­å¿ƒé¸ä½ç½®

https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a129

      
å…§å®¹      
 æœ‰ n      
 å€‹å°æ‘èŠä»¥ 0      
 ~ nâˆ’1      
 ç·¨è™Ÿï¼Œå…¶ä¸­ç·¨è™Ÿ 0      
 çš„æ˜¯å¸‚æ”¿åºœæ‰€åœ¨åœ°ï¼Œé€™äº›æ‘èŠä»¥ nâˆ’1      
 æ¢é“è·¯é€£æ¥ï¼Œæ¯æ¢é“è·¯éƒ½æ˜¯é›™å‘é€šè¡Œä¸”é€£æ¥å…©å€‹ä¸åŒçš„æ‘èŠï¼Œå·²çŸ¥å¾ä»»ä¸€å€‹æ‘èŠ i      
 éƒ½å¯ä»¥ç¶“ç”±é€™äº›é“è·¯åˆ°é”å¸‚æ”¿åºœæ‰€åœ¨çš„ 0      
 è™Ÿæ‘èŠï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥åˆ°é”ä»»ä½•å…¶ä»–æ‘èŠï¼Œè€Œä¸”ç”±æ‘èŠ i      
 å¾€å¸‚æ”¿åºœæœƒç¶“éçš„ç¬¬ä¸€ç«™æ‘èŠæ˜¯ p(i)ã€‚      

ç¾åœ¨æŸå¤§é›†åœ˜å¸Œæœ›é¸å…¶ä¸­ä¸€å€‹æ‘èŠä¾†è“‹ä¸€å€‹è³¼ç‰©ä¸­å¿ƒï¼Œé¸å€çš„åˆ¤æ–·æ–¹å¼æ˜¯è³¼ç‰©ä¸­å¿ƒåˆ°æ‰€æœ‰æ‘èŠçš„è·é›¢ç¸½å’Œè¦è¶Šå°è¶Šå¥½ï¼Œè«‹ä½ å¹«å¿™è¨ˆç®—å“ªä¸€å€‹æ‘èŠæ˜¯æœ€å¥½çš„ä½ç½®ï¼Œåˆ°å„æ‘èŠçš„è·é›¢ç¸½å’Œæœ€å°æ˜¯å¤šå°‘ã€‚   

è¼¸å…¥èªªæ˜     
 ç¬¬ä¸€è¡Œæ˜¯æ­£æ•´æ•¸ nï¼Œn>1ï¼Œæ‘èŠä»¥ 0~ nâˆ’1ç·¨è™Ÿã€‚     
æ¥ä¸‹ä¾†æœ‰ nâˆ’1è¡Œæ˜¯é“è·¯çš„è³‡æ–™ï¼Œ iç”± 1åˆ° nâˆ’1ï¼Œç¬¬ iè¡Œæœ‰ 2å€‹æ•´æ•¸ p(i)èˆ‡w(i)ï¼Œä»£è¡¨ iå¾€ 0è™Ÿæ‘èŠçš„é“è·¯ç¬¬ä¸€å€‹æœƒç¶“é p(i)ï¼Œè€Œ ièˆ‡ p(i)ä¹‹é–“çš„é“è·¯é•·åº¦æ˜¯ w(i)ã€‚nä¸è¶…é 105     
ï¼Œæ¯æ¢é“è·¯çš„é•·åº¦æ˜¯ä¸è¶…é 1000çš„æ­£æ•´æ•¸ã€‚     
     
è¼¸å‡ºèªªæ˜     
ç¬¬ä¸€è¡Œè¼¸å‡ºæœ€ä½³çš„æ‘èŠç·¨è™Ÿï¼Œå¦‚æœæœ‰è¶…éä¸€å€‹æ‘èŠéƒ½æ˜¯æœ€ä½³ä½ç½®ï¼Œå‰‡æ‰¾é›¢å¸‚æ”¿åºœæœ€é çš„é‚£ä¸€å€‹ï¼Œ         
ç¬¬äºŒè¡Œè¼¸å‡ºæœ€ä½³æ‘èŠåˆ°å„æ‘èŠè·é›¢ç¸½å’Œã€‚         
         
ç¯„ä¾‹è¼¸å…¥ #1         
5         
0 5         
4 1         
4 4         
0 2    
ç¯„ä¾‹è¼¸å‡º #1    
4    
14    
ç¯„ä¾‹è¼¸å…¥ #2    
6        
0 9        
0 1    
2 1    
5 3    
3 2    
ç¯„ä¾‹è¼¸å‡º #2    
3    
21    
          
---      
é€™è£¡ç”¨åˆ°ä¸€å€‹æŠ€å·§ï¼šè¨ˆç®—å­æ•¸æ•¸é‡ï¼Œä¹Ÿå°±æ˜¯åŒ…å«kï¼Œå†kä¹‹ä¸‹ç¯€é»æ•¸é‡ã€‚      
å¯ç”¨button upè¨ˆç®—æ•¸é‡      
      
---      


é€™é¡ŒæœƒéŒ¯å¾ˆæœ‰å¯èƒ½æ˜¯æ²’æœ‰æŠŠmi_disè¨­ç‚ºLONG_LONG_MAX


/// collapse-code  
```cpp  
#include<bits/stdc++.h>
using namespace std;
#define nn "\n"
#define N int(1e5+10)
#define x first
#define y second

vector< pair<int,int>>v[N];

long long subtree[N];
long long sumdis[N];
long long ansdis[N];
long long dis[N];
long long n;
bool visit1[N]={false},visit2[N]={false};
long long dfs1(long long f){
    visit1[f]=true;
    subtree[f]=1;
    for(pair<int,int> i : v[f]){
        if(!visit1[i.first]){
            //cout<<i.first<<" ";
            sumdis[i.x]=sumdis[f]+i.y;
            dis[i.x]=dis[f]+1;
            dfs1(i.first);
            subtree[f]+=subtree[i.first];
        }
    }
}
long long dfs2(long long f){
    visit2[f]=true;
    for(pair<int,int> i : v[f]){
        if(!visit2[i.first]){
            ansdis[i.x] = ansdis[f] - subtree[i.x] * i.y + (n - subtree[i.x]) * i.y;
            dfs2(i.first);
        }
    }
}
int  main(){
    //istringstream cin("5 \
0 5 \
4 1 \
4 4 \
0 2 \
");
    cin>>n;
    for(long long i=1;i<n;i++){
        long long a,b;
        cin>>a>>b;
        v[i].push_back({a,b});
        v[a].push_back({i,b});
    }
    dfs1(0);
    for(long long i=0;i<n;i++){
        ansdis[0]+=sumdis[i];
    }
    dfs2(0);
    long long mi_tree=INT_MIN,mi_dis=LONG_LONG_MAX,mi_index;
    for(long long i=0;i<n;i++){
        if(ansdis[i]<mi_dis){
            mi_dis=ansdis[i];
            mi_tree=sumdis[i];
            mi_index=i;
        }
        else if(ansdis[i]==mi_dis && sumdis[i]>mi_tree){
            mi_dis=ansdis[i];
            mi_tree=sumdis[i];
            mi_index=i;
        }
    }
    cout<<mi_index<<endl<<mi_dis<<nn;
}
```
///

### a078: P\_3\_1 æ¨¹çš„é«˜åº¦èˆ‡æ ¹ (bottom-up) (APCS201710)
https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a078

å…§å®¹
æœ‰ä¸€å€‹å¤§å®¶æ—æœ‰ N å€‹æˆå“¡ï¼Œç·¨è™Ÿ 1~Nï¼Œæˆ‘å€‘è«‹æ¯å€‹æˆå“¡å¯«ä¸‹æ­¤å®¶æ—ä¸­å“ªå¹¾ä½æ˜¯ä»–çš„å­© å­ã€‚æˆ‘å€‘è¦è¨ˆç®—æ¯å€‹äººæœ‰å¹¾ä»£çš„å­å­«ï¼Œé€™å€‹å€¼ç¨±ç‚ºä»–åœ¨é€™å€‹æ—è­œä¸­çš„é«˜åº¦ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œ ç·¨è™Ÿ i çš„äººå¦‚æœé«˜åº¦è¨˜åš h(i)ï¼Œé‚£éº¼ h(i)å°±è¡¨ç¤ºåœ¨æ‰€æœ‰ i çš„å­å­«ä¸­ï¼Œæœ€é çš„å­å­« èˆ‡ä»–éš”äº†å¹¾ä»£ã€‚æœ¬é¡Œå‡è¨­é™¤äº†æœ€é«˜çš„ä¸€ä½ç¥–å…ˆ(ç¨±ç‚º root)ä¹‹å¤–ï¼Œå…¶ä»–æˆå“¡çš„ parent éƒ½åœ¨æ­¤å®¶æ—ä¸­(ä¸”åªæœ‰ä¸€å€‹ parent)ã€‚æœ¬é¡Œè¦è¨ˆç®—æ‰€æœ‰æˆå“¡é«˜åº¦çš„ç¸½å’Œä»¥åŠæ ¹çš„ç·¨ è™Ÿã€‚ å³åœ–æ˜¯ä¸€å€‹ä¾‹å­ï¼Œæ¯å€‹æˆå“¡æ˜¯ä¸€å€‹åœˆèµ·ä¾† çš„è™Ÿç¢¼ï¼ŒåŠƒç·šç›¸è¯çš„è¡¨ç¤ºä¸Šé¢çš„é»æ˜¯ä¸‹é¢ é»çš„ parentã€‚ç·¨è™Ÿ 4 æ˜¯æ ¹ï¼Œæœ‰å…©å€‹å­©å­ 1 èˆ‡ 7ã€‚ç·¨è™Ÿ 6, 9, 3, 8 éƒ½æ²’æœ‰å­©å­ï¼Œ h(6)=h(9)=h(3)=h(8)=0ï¼Œæ­¤å¤– h(2)=2 å› ç‚º 9 èˆ‡ä»–éš”å…©ä»£ã€‚ä½ å¯ä»¥çœ‹å‡º ä¾† h(5)=h(1)=1ï¼Œh(7)=3, h(4)=4ï¼Œ æ‰€ä»¥é«˜åº¦ç¸½å’Œæ˜¯ 11ã€‚

![alt text](../images/æ¨¹è«–/B1f-8_8ER.png){width=50%}

è¼¸å…¥èªªæ˜     
ç¬¬ä¸€è¡Œæœ‰ä¸€å€‹æ­£æ•´æ•¸ Nã€‚æ¥ä¸‹ä¾†æœ‰ N è¡Œï¼Œç¬¬ i è¡Œçš„ç¬¬ä¸€å€‹æ•¸å­— k ä»£è¡¨ i æœ‰ k å€‹å­©å­ï¼Œç¬¬ i è¡Œæ¥ä¸‹ä¾†çš„ k å€‹æ•¸å­—å°±æ˜¯å­©å­çš„ç·¨è™Ÿã€‚æ¯ä¸€è¡Œçš„ç›¸é„°æ•¸å­—é–“ä»¥ç©ºç™½éš” é–‹ã€‚N â‰¤ 1e5ã€‚      
     
è¼¸å‡ºèªªæ˜     
ç¬¬ä¸€è¡Œè¼¸å‡ºæ ¹çš„ç·¨è™Ÿï¼Œç¬¬äºŒè¡Œè¼¸å‡ºé«˜åº¦ç¸½å’Œã€‚     
     
ç¯„ä¾‹è¼¸å…¥ #1     
9     
1 6     
3 5 3 8     
0     
2 1 7          
1 9          
0          
1 2          
0     
0     
     
ç¯„ä¾‹è¼¸å‡º #1     
4     
11     
     

>çœ‹åˆ°ç¬¬11ã€12è¡Œ
>```cpp
>dfs(i);
>dis[f]=max(dis[f],dis[i]+1);
>```
>ä¸Šé¢é€™æ¨£å¯«çš„è©±æ˜¯bottom-upçš„DP
>
>å¦‚æœæ›æˆï¼š
>```cpp
>dis[f]=max(dis[f],dis[i]+1);
>dfs(i);
>```
>å°±æ˜¯top-downçš„DP

/// collapse-code  
```cpp  
#include<bits/stdc++.h>
using namespace std;
#define nn "\n"
#define N 100000
vector<int>v[N];
bool visit[N];
int rool[N];
int dis[N]={0},rdis[N];
int dfs(int f){
    //dis[f]=1;
    for(int i:v[f]){
        dfs(i);
        dis[f]=max(dis[f],dis[i]+1);
    }
}
int main(){
    //istringstream cin("9 \
1 6 \
3 5 3 8 \
0 \
2 1 7 \
1 9 \
0 \
1 2 \
0 \
0");
    int n;
    cin>>n;
    for(int i=1;i<=n;i++){
        int x;
        cin>>x;
        for(int j=1;j<=x;j++){
            int y;
            cin>>y;
            rool[y]=1;
            v[i].push_back(y);
        }
    }
    int r;
    for(int i=1;i<=n;i++){
        if(rool[i]==0){
            r=i;
        }
    }
    cout<<r<<nn;
    dfs(r);
    int ans=0;
    for(int i=1;i<=n;i++){
        ans+=dis[i];
    }
    cout<<ans;
}

```
///

### a131: P\_8\_5 è‡ªå‹•åˆ†è£ (APCS202002)
https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a131

å…§å®¹
æŸå·¥ç¨‹å…¬å¸è¨­è¨ˆäº†ä¸€å€‹è‡ªå‹•åˆ†è£çš„ç³»çµ±ã€‚è²¨ç‰©æœƒä¸€å€‹ä¸€å€‹çš„è¢«é€é€²æ­¤ç³»çµ±ï¼Œç¶“éä¸€äº›åˆ‡æ›å™¨çš„è½‰é€å¾Œï¼Œæœƒè¢«è¼¸é€åˆ° nå€‹è²¨ç®±ã€‚ç³»çµ±æœ‰nâ€“1å€‹åˆ‡æ›å™¨èˆ‡nå€‹è²¨ç®±ã€‚æ¯å€‹åˆ‡æ›å™¨æœ‰ä¸€å€‹å…¥å£ä»¥åŠå·¦å³å…©å€‹å‡ºå£ï¼Œåˆ‡æ›å™¨çš„å‡ºå£æœƒæ¥åˆ°å…¶ä»–åˆ‡æ›å™¨æˆ–æ˜¯é€£æ¥åˆ°è²¨ç®±ï¼Œè²¨ç®±å‰‡åªæœ‰å…¥å£ã€‚ä¸‹åœ–æ˜¯ä¸€å€‹n=7çš„ä¾‹å­ï¼Œåœ“ä»£è¡¨åˆ‡æ›å™¨ï¼Œæ–¹å½¢ä»£è¡¨è²¨ç®±ï¼Œè«‹æ³¨æ„ç·¨è™Ÿ1 ~ nâ€“1çš„è£ç½®æ˜¯åˆ‡æ›å™¨ï¼Œè²¨ç®±ç·¨è™Ÿæ˜¯ n ~ 2nâ€“1ï¼Œä¸”è²¨ç‰©å…¥å£ä¸€å®šæ˜¯1è™Ÿåˆ‡æ›å™¨çš„å…¥å£ã€‚


æ¯ä¸€å€‹åˆ‡æ›å™¨æœƒåˆ†åˆ¥è¨˜éŒ„å·¦å³å…©å€‹å‡ºå£æ‰€é€šå¾€è²¨ç®±çš„ç¸½é‡é‡ï¼Œç•¶è²¨ç‰©é€²å…¥æ­¤åˆ‡æ›å™¨æ™‚ï¼Œåˆ‡æ›å™¨æœƒå°‡è²¨ç‰©è½‰é€åˆ°ã€Œè²¨ç®±ç¸½é‡é‡æ¯”è¼ƒè¼•çš„é‚£å€‹å‡ºå£ã€ï¼Œå¦‚æœå…©é‚Šä¸€æ¨£é‡ï¼Œå‰‡é€å¾€å·¦é‚Šã€‚ä»¥ä¸Šåœ–çš„ä¾‹å­ä¾†èªªï¼Œå‡è¨­æ¯ä¸€å€‹è²¨ç®±ç›®å‰çš„é‡é‡å¦‚å„çŸ©å½¢ä¸‹æ–¹çš„æ¨™ç¤ºï¼Œä¸‹ä¸€å€‹åˆ°é”çš„è²¨ç‰©çš„é‹é€éç¨‹å¦‚ä¸‹ï¼šä¸€è™Ÿåˆ‡æ›å™¨å·¦é‚Šå‡ºå£æ˜¯é€£åˆ° {13, 10, 7} ä¸‰å€‹è²¨ç®±ï¼Œç›®å‰ç¸½é‡5+6+9=20ï¼›å³é‚Šå‡ºå£é€£åˆ°çš„æ˜¯ {12, 8, 11, 9} å››å€‹è²¨ç®±ï¼Œç›®å‰ç¸½é‡7+2+8+1=18ï¼Œå› æ­¤è²¨ç‰©æœƒç”±å³é‚Šå‡ºå£é€åˆ°5è™Ÿåˆ‡æ›å™¨ã€‚5è™Ÿåˆ‡æ›å™¨çš„å·¦é‚Šèˆ‡å³é‚Šçš„è²¨ç®±ç¸½é‡æ˜¯ä¸€æ¨£çš„ï¼ˆ7+2=8+1ï¼‰ï¼Œå› æ­¤è²¨ç‰©ç”±å·¦å‡ºå£é€è‡³6è™Ÿåˆ‡æ›å™¨ã€‚æœ€å¾Œï¼Œ6è™Ÿåˆ‡æ›å™¨å°‡è²¨ç‰©é€åˆ°8è™Ÿè²¨ç®±ï¼ˆ7>2)ã€‚è²¨ç‰©é€²å…¥è²¨ç®±å¾Œå°±å­˜æ”¾åœ¨è©²è²¨ç®±ï¼Œè©²è²¨ç‰©çš„é‡é‡å°±æœƒåŠ å…¥è©²è²¨ç®±çš„ç¸½é‡ï¼Œå› æ­¤å¯èƒ½å½±éŸ¿ä¸‹ä¸€å€‹è²¨ç‰©çš„é‹é€è·¯å¾‘ã€‚

è¼¸å…¥æ­¤ç³»çµ±çš„é€£æ¥æ¶æ§‹èˆ‡è²¨ç®±ç›®å‰çš„é‡é‡ï¼Œä»¥åŠæ¥ä¸‹ä¾†ä¾åºé€²å…¥çš„ må€‹è²¨ç‰©çš„é‡é‡ï¼Œè«‹è¨ˆç®—é€™ m å€‹è²¨ç‰©åˆ†åˆ¥æœƒè¢«é€åˆ°å“ªä¸€å€‹è²¨ç®±ã€‚

![alt text](../images/æ¨¹è«–/Hy8GSt84C.png){width=100%}   


è¼¸å…¥èªªæ˜    
ç¬¬ä¸€è¡Œç‚ºå…©å€‹æ­£æ•´æ•¸n å’Œmï¼Œå…¶ä¸­n â‰¤ 1e5ä¸”m â‰¤ 100ã€‚    
ç¬¬äºŒè¡Œæœ‰n å€‹éè² æ•´æ•¸ï¼Œä¾åºæ˜¯ç·¨è™Ÿç‚ºn ~ 2nâ€“1å„å€‹è²¨ç®±åˆå§‹çš„é‡é‡ã€‚    
ç¬¬ä¸‰è¡Œæ˜¯må€‹æ­£æ•´æ•¸ï¼Œä»£è¡¨æ¥ä¸‹ä¾†ä¾åºé€²å…¥çš„è²¨ç‰©é‡é‡ã€‚å…¨éƒ¨è²¨ç®±åˆå§‹çš„é‡é‡èˆ‡è²¨ç‰©é‡é‡ç¸½å’Œä¸æœƒè¶…é1e9ã€‚    
ç¬¬å››è¡Œé–‹å§‹æœ‰nâ€“1è¡Œï¼Œé€™äº›æ˜¯ç³»çµ±æ¶æ§‹çš„è³‡è¨Šï¼šæ¯ä¸€è¡Œæœ‰ä¸‰å€‹æ•´æ•¸pã€sèˆ‡tï¼Œä»£è¡¨è£ç½®pçš„å·¦å³å‡ºå£åˆ†åˆ¥æ¥åˆ°è£ç½®sèˆ‡tï¼Œå…¶ä¸­pä¸€å®šæ˜¯ä¸€å€‹åˆ‡æ›å™¨çš„ç·¨è™Ÿ(1 â‰¤ p < n)ã€‚åŒä¸€è¡Œæ•¸å­—ä¹‹é–“ä»¥ç©ºç™½é–“éš”ã€‚    
     
è¼¸å‡ºèªªæ˜     
è¼¸å‡ºä¸€è¡Œæœ‰må€‹æ•´æ•¸ï¼Œä¾åºä»£è¡¨æ¥ä¸‹ä¾†é€²å…¥ç³»çµ±çš„må€‹è²¨ç‰©æ‰€é€²å…¥åˆ°çš„è²¨ç®±ç·¨è™Ÿï¼Œæ•¸å­—ä¹‹é–“ä»¥ä¸€å€‹ç©ºç™½é–“éš”ã€‚     
     
ç¯„ä¾‹è¼¸å…¥ #1     
ç¯„ä¾‹ä¸€ï¼š     
4 5     
0 0 0 0     
5 3 4 2 1     
1 2 3     
2 4 5     
3 6 7     
          
ç¯„ä¾‹äºŒï¼š   
7 2     
9 2 1 6 8 7 5     
2 3     
1 2 5     
2 3 7     
3 13 10     
4 11 9     
6 12 8     
5 6 4     
     
ç¯„ä¾‹è¼¸å‡º #1     
ç¯„ä¾‹ä¸€ï¼š       
4 6 7 5 5     
     
ç¯„ä¾‹äºŒï¼š  
8 7     
/// collapse-code  
```cpp     
#include<bits/stdc++.h>     
using namespace std;
#define N 200000
#define nn "\n"
#define int long long
int n,m;
int w[N];
int in[101];
int input=0;
vector<int>v[N]; // [0]:L  [1]:R
int dfs(int f){
    for(int i:v[f]){
        dfs(i);
        w[f]+=w[i];
    }
    return 0;
}
int dfsin(int f){
    if(f>=n){ //leaf
        cout<<f<<" ";
        return 0;
    }
    int l=v[f][0];
    int r=v[f][1];
    if(w[l]<=w[r]){
        w[l]+=input;
        dfsin(l);
    }
    else{
        w[r]+=input;
        dfsin(r);
    }
    return 0;
}
signed main(){
    ios::sync_with_stdio(0);
    cin.tie(0);
//    stringstream cin("7 2 \
9 2 1 6 8 7 5 \
2 3 \
1 2 5 \
2 3 7 \
3 13 10 \
4 11 9 \
6 12 8 \
5 6 4");
    cin>>n>>m;
    for(int i=n;i<=2*n-1;i++){
        cin>>w[i];
    }
    for(int i=0;i<m;i++){
        cin>>in[i];
    }
    for(int i=1;i<n;i++){
        int x,y,z;
        cin>>x>>y>>z;
        v[x].push_back(y);
        v[x].push_back(z);
    }
    dfs(1);
    for(int i=0;i<m;i++){
        input=in[i];
        w[1]+=input;
        dfsin(1);
    }
    return 0;
}
```
///


### a223: Q\_8\_6 æ¨¹ç‹€åœ–çš„è·é›¢ç¸½å’Œ
https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a223
å…§å®¹     
     
Â è¼¸å…¥ä¸€å€‹æ¨¹ç‹€åœ–ï¼Œè«‹è¨ˆç®—æ‰€æœ‰é»åˆ°æ‰€æœ‰é»çš„è·é›¢ç¸½å’Œã€‚æœ¬é¡Œå‡è¨­ç·¨è™Ÿ 1  1 æ˜¯æ ¹ç¯€é»ã€‚     
     
è¼¸å…¥èªªæ˜     
     
ç¬¬ä¸€è¡Œæ˜¯æ­£æ•´æ•¸ n  ğ‘›ï¼Œä»£è¡¨é»æ•¸ï¼Œé»ä»¥ 1âˆ¼n  1âˆ¼ğ‘›ç·¨è™Ÿï¼Œ     
     
ç¬¬äºŒè¡Œæœ‰ nâˆ’1  ğ‘›âˆ’1 å€‹æ­£æ•´æ•¸ï¼Œ p(2),p(3),â€¦,p(n)  ğ‘(2),ğ‘(3),â€¦,ğ‘(ğ‘›) ï¼Œä¾åºæ˜¯ç·¨è™Ÿ 2âˆ¼n  2âˆ¼ğ‘›å„é»çš„parentï¼Œ     
     
ç¬¬ä¸‰è¡Œæœ‰ nâˆ’1  ğ‘›âˆ’1 å€‹æ­£æ•´æ•¸ï¼Œä¾åºä»£è¡¨ i  ğ‘– å¾ 2  2 åˆ° n  ğ‘›ï¼Œé‚Š (i,p(i))  (ğ‘–,ğ‘(ğ‘–)) çš„é•·åº¦ã€‚n  ğ‘› ä¸è¶…é 10 5   105ï¼Œæ¯æ¢é‚Šé•·åº¦æ˜¯ä¸è¶…é 1000  1000 çš„æ­£æ•´æ•¸ã€‚     
     
è¼¸å‡ºèªªæ˜     
     
Â å„é»åˆ°å„é»çš„è·é›¢ç¸½å’Œã€‚è«‹æ³¨æ„ i  ğ‘– åˆ° j  ğ‘— èˆ‡ j  ğ‘— åˆ° i  ğ‘– éƒ½è¦ç´å…¥ç¸½å’Œï¼Œå¦‚ç¯„ä¾‹ã€‚     
     
ç¯„ä¾‹è¼¸å…¥ #1     
     
4     
1 2 3     
10 20 30     
     
ç¯„ä¾‹è¼¸å‡º #1     
     
400     
     
ç¯„ä¾‹è¼¸å…¥ #2     
     
5     
1 1 1 2     
20 20 30 30     
     
ç¯„ä¾‹è¼¸å‡º #2     
     
880    

/// collapse-code  
```cpp  
#include<bits//stdc++.h>
using namespace std;
#define N  int(1e5+10)
#define nn "\n"
vector<int>v[N];
long long subtree[N];
long long w[N];
long long dis[N];
long long n;
long long dfs(long long f){
    subtree[f]=1;
    for(long long i:v[f]){
        dis[i]=dis[f]+w[i];
        dfs(i);
        subtree[f]+=subtree[i];
    }
}
long long dfs1(long long f){
    for(long long i:v[f]){
        dis[i]=  dis[f]   - subtree[i]*w[i] +    (n-subtree[i])*w[i]    ;
        //cout<<i<<": "<<dis[i]<<nn;
        dfs1(i);

    }
}
int main(){
    ios::sync_with_stdio(0);
    cin.tie(0);
    //istringstream cin("4 \
1 2 3 \
10 20 30");

    //istringstream cin("5 \
1 1 1 2 \
20 20 30 30");
    cin>>n;
    for(long long i=2;i<=n;i++){
        long long x;
        cin>>x;
        v[x].push_back(i);
    }
    for(long long i=2;i<=n;i++){
        cin>>w[i];
    }
    dfs(1);
    for(long long i=2;i<=n;i++){
            dis[1]+=dis[i];
    }
    dfs1(1);
    long long ans=0;
    for(long long i=1;i<=n;i++){
        ans+=dis[i];
    }
    cout<<ans;
}

```
///


### a132: P\_8\_7 å¯¶çŸ³çš„é¡è‰² (108å…¨åœ‹é«˜ä¸­è³½)      
https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a132      
      
      
å…§å®¹      
      
Â å°‹å¯¶ä¹‹æ—…çš„éŠæˆ²æœ‰ä¸€å€‹åœ°åœ–ï¼Œåœ°åœ–ä¸Šæœ‰ n å€‹ç«™ï¼Œä»¥ 0 åˆ° (n â€“ 1) ç·¨è™Ÿï¼Œæ­¤å¤–æœ‰ (n â€“ 1) æ¢é“è·¯ï¼Œé€™äº›é“è·¯éƒ½æ˜¯å–®å‘çš„ï¼ŒéŠæˆ²å›ºå®šå¾ 0 è™Ÿç«™å‡ºç™¼ï¼Œä¸”å·²çŸ¥å¾ 0 è™Ÿç«™å‡ºç™¼å¯ä»¥ç›´æ¥æˆ–é–“æ¥åˆ°é”ä»»ä½•å…¶ä»–      ç«™ã€‚æ¯ä¸€å€‹ç«™éƒ½æœ‰ä¸€é¡†å¯¶çŸ³ï¼Œå¯¶çŸ³æœ‰åˆ†ç‚ºå¤šç¨®é¡è‰²ï¼Œç¬¬ i ç«™å­˜æ”¾çš„å¯¶çŸ³é¡è‰²ç‚º c(i)ã€‚å‡ºç™¼ä¹‹å‰ï¼Œä½ å¯ä»¥é¸å®šä¸€ç¨®é¡è‰²çš„å¯¶çŸ³æ”¶é›†ç®±ï¼Œè·¯é€”ä¸­é‡åˆ°èˆ‡ä½ çš„æ”¶é›†ç®±ç›¸åŒé¡è‰²çš„å¯¶çŸ³å°±å¯ä»¥æ”¶é›†(åŒ…å«èµ·é»)ï¼Œè«‹ä½       è¨ˆç®—æœ€å¤šå¯ä»¥æ”¶é›†åˆ°å¤šå°‘é¡†åŒè‰²å¯¶çŸ³ã€‚      
      
è¼¸å…¥èªªæ˜      
      
Â ç¬¬ä¸€è¡Œæœ‰æ˜¯ä¸€å€‹æ­£æ•´æ•¸nï¼Œ n â‰¤ 2e5ï¼Œä»£è¡¨åœ°åœ–ä¸Šæœ‰ n å€‹ç«™ã€‚ç¬¬äºŒè¡Œæ˜¯ n å€‹éè² æ•´æ•¸ï¼Œä¾åºä»£è¡¨æ¯ä¸€ç«™çš„å¯¶çŸ³é¡è‰²è™Ÿç¢¼ c(0), c(1), â€¦, c(n â€“ 1)ï¼›å¯¶çŸ³çš„é¡è‰²è™Ÿç¢¼ä¸è¶…é1e9ã€‚æ¥è‘—æœ‰ (nâ€“1) è¡Œï¼Œæ¯è¡Œ      å…©å€‹ä»¥ç©ºç™½é–“éš”çš„æ•´æ•¸ s èˆ‡ t ï¼Œè¡¨ç¤ºæœ‰ä¸€æ¢ s åˆ° t çš„é“è·¯ã€‚      
      
è¼¸å‡ºèªªæ˜      
      
Â è¼¸å‡ºçˆ²ä¸€æ•´æ•¸ï¼Œä»£è¡¨æœ€å¤šå¯èƒ½æ”¶é›†åˆ°çš„å¯¶çŸ³æ•¸é‡ã€‚      
      
ç¯„ä¾‹è¼¸å…¥ #1      
      
6      
0 0 0 0 0 0      
0 1      
1 2      
0 3      
1 4      
1 5      
      
ç¯„ä¾‹è¼¸å‡º #1      
      
3      
      
ç¯„ä¾‹è¼¸å…¥ #2      
      
10      
5 3 3 1 4 0 3 4 5 0      
0 1      
5 2      
7 3      
5 4      
0 5      
4 6      
1 7      
0 8      
4 9      
      
ç¯„ä¾‹è¼¸å‡º #2      
      
2      
/// collapse-code  
```cpp  
#include<bits/stdc++.h>
using namespace std;
#define N 200001
#define nn "\n"
#define int long long

int w[N];
vector<int>v[N];
map<int,int>b;
int ou[N]; //å‡ºåº¦
int n;
vector<int>ans;
int dfs(int f){
    if(ou[f]==0){//leaf
        int ma=0;
        for(auto i:b){
            ma=max(ma,i.second);
        }
        ans.push_back(ma);
        return 0;
    
    for(int i:v[f]){
        b[w[i]]++;
        dfs(i);
        b[w[i]]--;

    }
    return 0;
}

signed main(){
    ios::sync_with_stdio(0);
    cin.tie(0);
//    stringstream cin("10 \
5 3 3 1 4 0 3 4 5 0 \
0 8 \
5 2 \
7 3 \
5 4 \
0 5 \
4 6 \
1 7 \
0 1 \
4 9");
    cin>>n;
    for(int i=0;i<n;i++){
        cin>>w[i];
    }
    for(int i=1;i<n;i++){
        int x,y;
        cin>>x>>y;
        v[x].push_back(y);
        ou[x]++;
    }
    dfs(0);
    cout<<*max_element(ans.begin(),ans.end());
    return 0;
}

/*




*/
```
///



### a133: P\_8\_8 æ¨¹çš„æœ€å¤§ç¨ç«‹é›†
https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a133
å…§å®¹

Â è¼¸å…¥ä¸€æ£µæœ‰nå€‹é»çš„æ¨¹ï¼Œæˆ‘å€‘è¦æŒ‘é¸ä¸€ç¾¤å½¼æ­¤ä¸ç›¸é„°çš„é»ï¼Œè€Œä¸”æŒ‘é¸çš„é»è¶Šå¤šé»è¶Šå¥½ã€‚è«‹è¨ˆç®—æœ€å¤šå¯ä»¥æŒ‘å¤šå°‘é»ã€‚ä»¥ä¸‹åœ–ç‚ºä¾‹ï¼Œæˆ‘å€‘å¯ä»¥æŒ‘{0,3,4,5,6,7}å…±6é»ï¼Œæ²’æœ‰è¾¦æ³•æŒ‘å‡ºæ›´å¤šçš„ä¸ç›¸é„°çš„é»ã€‚      
      
![alt text](../images/æ¨¹è«–/image.png){width=50%}    

è¼¸å…¥èªªæ˜      
      
Â ç¬¬ä¸€è¡Œæ˜¯æ­£æ•´æ•¸nï¼Œä»£è¡¨é»æ•¸ï¼Œé»ä»¥0~n-1ç·¨è™Ÿï¼Œ0æ˜¯æ ¹ï¼Œç¬¬äºŒè¡Œæœ‰n-1å€‹æ­£æ•´æ•¸ï¼Œp(1), p(2), â€¦,p(n-1)ï¼Œä¾åºæ˜¯ç·¨è™Ÿ1~n-1å„é»çš„parentã€‚nä¸è¶…é1e5ï¼Œç›¸é„°æ•¸å­—ä»¥ç©ºç™½é–“éš”ã€‚      
      
è¼¸å‡ºèªªæ˜      
      
Â æœ€å¤šå¯ä»¥æŒ‘é¸å¹¾é»ã€‚      
      
ç¯„ä¾‹è¼¸å…¥ #1      
      
9      
0 0 1 1 2 2 2 6      
      
ç¯„ä¾‹è¼¸å‡º #1      
      
6      
      
ç¯„ä¾‹è¼¸å…¥ #2      
      
8      
0 1 2 3 3 2 2      
      
ç¯„ä¾‹è¼¸å‡º #2      
      
5      
      
      
/// collapse-code  
```cpp  
#include<bits/stdc++.h>
using namespace std;
#define N 100001
#define nn "\n"
#define int long long

vector<int>v[N];
int out[N];
int dp[N];


int dfs(int f){
    dp[f]=1;
    if(out[f]==0){//leaf
        dp[f]=1;
        return 0;
    }
    for(int i:v[f]){
        dfs(i);
        if(dp[i]==1){
            dp[f]=0;
        }
    }
    return 0;
}


signed main(){
    ios::sync_with_stdio(0);
    cin.tie(0);
//    stringstream cin("8 \
0 1 2 3 3 2 2");//    stringstream cin("8 \


    int n;
    cin>>n;

    for(int i=1;i<n;i++){
        int p;
        cin>>p;
        v[p].push_back(i);
        out[p]++;
    }


    dfs(0);

    int ans=0;
    for(int i=0;i<n;i++){
        if(dp[i]==1){
            ans++;
        }
    }

    cout<<ans;




    return 0;
}

/*




*/
```
///



### a224: Q_8_9 æœå‹™ä¸­å¿ƒé¸ä½ç½®

https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a224     
     
å…§å®¹     
     
Â æœ‰ n  ğ‘› å€‹å°æ‘èŠä»¥ 1âˆ¼n  1âˆ¼ğ‘› ç·¨è™Ÿï¼Œé€™äº›æ‘èŠä»¥ nâˆ’1  ğ‘›âˆ’1 æ¢é“è·¯é€£æ¥ï¼Œæ¯æ¢é“è·¯éƒ½æ˜¯é›™å‘é€šè¡Œä¸” é€£æ¥å…©å€‹ä¸åŒçš„æ‘èŠï¼Œå·²çŸ¥å¾ä»»å…©å€‹æ‘èŠä¹‹é–“éƒ½å¯ä»¥ç¶“ç”±é€™äº›é“è·¯é€šé”ï¼Œå…©å€‹æ‘èŠç¨±ç‚ºé„°è¿‘çš„æ‘     èŠï¼Œå¦‚æœå®ƒå€‘ä¹‹é–“æœ‰ä¸€æ¢é“è·¯ç›´æ¥ç›¸é€£ã€‚     
     
ç¾åœ¨è¦é¸ä¸€äº›æ‘èŠæˆç«‹æœå‹™ä¸­å¿ƒï¼Œ å› ç‚ºé ç®—çš„é—œä¿‚ç„¡æ³•æ¯å€‹æ‘èŠéƒ½æˆç«‹ä¸€å€‹æœå‹™ä¸­å¿ƒï¼Œæ”¿åºœçš„æ”¿ç­–æ±ºå®šï¼šå¦‚æœæŸå€‹æ‘èŠæ²’æœ‰è¨­æœå‹™ä¸­å¿ƒï¼Œé‚£éº¼ä»–ä¸€å®šæœ‰ä¸€å€‹é„°è¿‘çš„æ‘èŠæœ‰æœå‹™ä¸­å¿ƒã€‚ä¹Ÿå°±æ˜¯èªªï¼Œä»»ä½•ä¸€å€‹æ‘     èŠæœ€å¤šåªè¦ç¶“éä¸€æ¢é“è·¯å°±å¯ä»¥åˆ°é”ä¸€å€‹æœ‰è¨­æœå‹™ä¸­å¿ƒçš„æ‘èŠã€‚è«‹ä½ è¨ˆç®—è‡³å°‘éœ€è¦æˆç«‹å¹¾å€‹æœå‹™ä¸­å¿ƒã€‚     
     
è¼¸å…¥èªªæ˜     
     
ç¬¬ä¸€è¡Œæ˜¯æ­£æ•´æ•¸ n  ğ‘›ï¼Œn>1  ğ‘›>1ï¼Œæ‘èŠä»¥ 1âˆ¼n  1âˆ¼ğ‘› ç·¨è™Ÿã€‚æ¥ä¸‹ä¾†æœ‰ nâˆ’1  ğ‘›âˆ’1 è¡Œæ˜¯é“è·¯çš„è³‡æ–™ï¼Œæ¯ä¸€è¡Œæœ‰å…©å€‹æ­£æ•´æ•¸ u  ğ‘¢ èˆ‡ v  ğ‘£ï¼Œä»£è¡¨æœ‰ä¸€æ¢é“è·¯é€£æ¥ u  ğ‘¢ èˆ‡ v  ğ‘£ã€‚n  ğ‘› ä¸è¶…é 10      5   105ã€‚     
     
è¼¸å‡ºèªªæ˜     
     
Â æœ€å°‘éœ€è¦æˆç«‹çš„æœå‹™ä¸­å¿ƒæ•¸é‡ã€‚     
     
ç¯„ä¾‹è¼¸å…¥ #1     
     
5     
1 2     
5 1     
5 3     
5 4     
     
ç¯„ä¾‹è¼¸å‡º #1     
     
2     
     
ç¯„ä¾‹è¼¸å…¥ #2     
     
7     
1 2     
2 3     
4 3     
5 4     
5 6     
7 6     
     
ç¯„ä¾‹è¼¸å‡º #2     
     
3     
     
/// collapse-code  
```cpp  
#include<bits/stdc++.h>
using namespace std;
#define nn cout<<"\n";
#define N int(1e5)+1

vector<int>v[N];
int c[N];
bool visit[N];

int n;

void clv(){
    for(int i=1;i<=n;i++){
        visit[i]=false;
    }
}


int dfs(int f){
    visit[f]=true;
    if(v[f].size()==0){
        c[f]=0;
        return 0;
    }
    for(int i:v[f]){
        if(!visit[i]){
            //cout<<f<<": "<<i;
            //nn
            dfs(i);//1æ¶è¨­ 2æ—é‚Šæ¶è¨­ 0ç„¡æ¶è¨­
            if(c[f]==1){

                continue;
            }

            if(c[i]==0){
                c[f]=1;
            }
            else if(c[i]==1){
                c[f]=2;
            }
            else if(c[i]==2 && c[i]==-1){
                c[f]=0;
            }
        }
    }
}


int main(){
    ios::sync_with_stdio(0);
    cin.tie(0);


    //istringstream cin("5 \
1 2 \
5 1 \
5 3 \
5 4");

//istringstream cin("7 \
1 2 \
2 3 \
4 3 \
5 4 \
5 6 \
7 6");



    cin>>n;
    for(int i=1;i<=n;i++){
        int x,y;
        cin>>x>>y;
        v[x].push_back(y);
        v[y].push_back(x);
    }

    clv();

    dfs(1);
//nn
    int ans=0;
    for(int i=1;i<=n;i++){
        if(c[i]==1){
            ans++;
        }
        //cout<<c[i]<< " ";
    }


    for(int i=1;i<=n;i++){
        //cout<<c[i]<<" ";
    }

    int p=1;
    for(int i:v[1]){
        if(c[i]==1){
            p=0;
        }
    }

//nn
    cout<<ans+p;

}

```
///

### a225: Q\_8\_10 ç«Šè½é–“è«œç¶²
https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a225
      
å…§å®¹      
      
æœ‰ n  ğ‘› å€‹é–“è«œï¼Œä»–å€‘çš„ ID ä»¥ 0âˆ¼(nâˆ’1)  0âˆ¼(ğ‘›âˆ’1) ç·¨è™Ÿï¼Œé–“è«œé ­å­çš„ ID æ˜¯ 0  0ï¼Œé™¤äº†ä»–ä»¥å¤–æ¯å€‹é–“è«œ éƒ½æœ‰ä¸€å€‹é ˜å°ï¼Œæ¯å€‹é–“è«œåªæœƒèˆ‡ä»–çš„é ˜å°ç›¸äº’é€šè©±ï¼Œç¾åœ¨æˆ‘å€‘è¦ç«Šè½é–“è«œå€‘å½¼æ­¤çš„é€šè©±ï¼Œæ‰€ä»¥      è¦åœ¨ä¸€äº›é–“è«œçš„é€šè©±è£ç½®ä¸Šå®‰è£ç«Šè½å™¨ï¼Œè¦ç«Šè½åˆ°æŸå€‹é–“è«œèˆ‡ä»–é ˜å°çš„é€šè©±ï¼Œ å¿…é ˆè‡³å°‘åœ¨ä»–å€‘å…¶ä¸­ä¸€äººçš„é€šè©±è£ç½®ä¸Šå®‰è£ç«Šè½å™¨ã€‚å¦‚æœä¸æƒ³æ¼æ‰ä»»ä½•é€šè©±ï¼Œè‡³å°‘è¦ å®‰è£å¹¾å°ç«Šè½å™¨ã€‚      
      
è¼¸å…¥èªªæ˜      
      
ç¬¬ä¸€è¡Œæ˜¯æ­£æ•´æ•¸ n  ğ‘›ï¼Œä»£è¡¨é–“è«œæ•¸ï¼Œæ¯å€‹é–“è«œçš„ ID å¿…å®šå¤§æ–¼ä»–é ˜å°çš„ IDã€‚ ç¬¬äºŒè¡Œæœ‰ nâˆ’1  ğ‘›âˆ’1 å€‹æ•´æ•¸åˆ†åˆ¥æ˜¯ t 1 ,t 2 ,â€¦,t nâˆ’1   ğ‘¡1,ğ‘¡2,â€¦,ğ‘¡ğ‘›âˆ’1ï¼Œå…¶ä¸­ t i   ğ‘¡ğ‘– å°±æ˜¯ i  ğ‘– çš„é ˜å°ã€‚n        ğ‘› ä¸è¶…é 10 5   105ã€‚      
      
è¼¸å‡ºèªªæ˜      
      
Â æœ€å°‘çš„ç«Šè½å™¨æ•¸é‡ã€‚      
      
ç¯„ä¾‹è¼¸å…¥ #1      
      
5      
0 1 1 3      
      
ç¯„ä¾‹è¼¸å‡º #1      
      
2      
      
ç¯„ä¾‹è¼¸å…¥ #2      
      
7      
0 1 1 1 1 1      
      
ç¯„ä¾‹è¼¸å‡º #2      
      
1      
      

/// collapse-code  
```cpp  
#include<bits/stdc++.h>
using namespace std;
#define nn cout<<"\n";
#define N int(1e5)+1

vector<int>v[N];
int c[N];
bool visit[N];

int n;

void clv(){
    for(int i=1;i<=n;i++){
        visit[i]=false;
    }
}


int dfs(int f){
    visit[f]=true;
    if(v[f].size()==0){
        c[f]=0;
        return 0;
    }
    for(int i:v[f]){
        if(!visit[i]){
            //cout<<f<<": "<<i;
            //nn
            dfs(i);//1æœ‰ 0ç„¡
            if(c[f]==1){

                continue;
            }

            if(c[i]==0){
                c[f]=1;
            }
            else if(c[i]==1){
                c[f]=0;
            }
        }
    }
}


int main(){
    ios::sync_with_stdio(0);
    cin.tie(0);

    //istringstream cin("5 \
0 1 1 3");

//istringstream cin("7 \
0 1 1 1 1 1");

    cin>>n;
    for(int i=1;i<n;i++){
        int x,y;
        cin>>x;
        v[x].push_back(i);
    }

    clv();
    dfs(0);


    int ans=0;
    for(int i=0;i<n;i++){
        if(c[i]==1){
            ans++;
        }
    }


    cout<<ans;

}
```
///



### a134: P\_8\_11 å…¬å¸æ´¾å° (NCPC)
https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a134

å…§å®¹

æœ‰ä¸€å€‹å…¬å¸æœ‰ n  ğ‘› å€‹æˆå“¡ï¼Œæˆå“¡ä»¥ 1âˆ¼n  1âˆ¼ğ‘› ç·¨è™Ÿï¼Œæ¯å€‹äººéƒ½æœ‰ä¸€å€‹é ˜å°ï¼Œé™¤äº†ç·¨è™Ÿ 1  1 æ˜¯å…¬å¸çš„ç¸½è£ï¼Œä»–æ²’æœ‰é ˜å°ã€‚ç¾åœ¨è¦è¾¦ä¸€å€‹å…¬å¸æ´¾å°ï¼Œæƒ³è¦é‚€è«‹ä¸€äº›äººä¾†åƒåŠ ï¼Œå¦‚æœé‚€è«‹äº†ç·¨è™Ÿiçš„äººä¾†åƒåŠ ï¼Œå°±æœƒæœ‰ r(i)  ğ‘Ÿ(ğ‘–) çš„æ­¡æ¨‚æŒ‡æ•¸ï¼Œå¯æ˜¯ï¼Œé€™å€‹å…¬å¸çš„ä»»ä½•äººéƒ½ä¸æƒ³è·Ÿä»–çš„é ˜å°ä¸€èµ·åƒåŠ æ´¾å°ï¼Œè«‹ä½ å¹«å¿™è¨ˆç®—è¦é‚€è«‹é‚£äº›äººä¾†åƒåŠ ï¼Œæ‰å¯ä»¥è®“åƒåŠ è€…çš„æ­¡æ¨‚æŒ‡æ•¸çš„ç¸½å’Œæœ€å¤§ã€‚

å³åœ–æ˜¯ä¸€å€‹ä¾‹å­ï¼Œæ¯å€‹åœ“åœˆä»£è¡¨ä¸€å€‹äººï¼Œåœ“åœˆå…§çš„æ•¸å­—æ˜¯ä»–çš„æ­¡æ¨‚æŒ‡æ•¸ï¼Œæ¯å€‹äººä¸Šæ–¹èˆ‡ä»–é€£ç·šçš„å°±æ˜¯ä»–çš„é ˜å°ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œç¸½è£çš„æ­¡æ¨‚æŒ‡æ•¸æ˜¯ 1  1ï¼Œä¹Ÿå…¨å…¬å¸æœ€ä½çš„ã€‚æˆ‘å€‘å¯ä»¥çœ‹åˆ°æ­¤ä¾‹ä¸­æœ‰å…©å€‹äººçš„æ­¡æ¨‚æŒ‡æ•¸æ˜¯ 14  14 èˆ‡ 11  11 ï¼Œå¯æƒœ 14  14 æ˜¯ 11  11 çš„é ˜å°ï¼Œæ‰€ä»¥ä¸èƒ½åŒæ™‚é‚€è«‹é€™å…©äººåƒåŠ ã€‚é€™å€‹ä¾‹å­çš„æœ€å¤§æ­¡æ¨‚æŒ‡æ•¸ç¸½å’Œæ˜¯ 66  66 ï¼Œæ‰£é™¤æ­¡æ¨‚æŒ‡æ•¸åˆ†åˆ¥ç‚º 1,3,3,4,14  1,3,3,4,14 é‚£ 5  5 å€‹äººï¼Œå…¶é¤˜çš„äººéƒ½åƒåŠ ã€‚

  
![alt text](../images/æ¨¹è«–/image-1.png){width=50%}



è¼¸å…¥èªªæ˜

ç¬¬ä¸€è¡Œæ˜¯å…©å€‹æ­£æ•´æ•¸ n  ğ‘› èˆ‡ r(1)  ğ‘Ÿ(1) ï¼Œæ¥ä¸‹ä¾†æœ‰ nâˆ’1  ğ‘›âˆ’1è¡Œï¼Œæ¯è¡Œå…©å€‹æ­£æ•´æ•¸ï¼Œç”± i=2âˆ¼n  ğ‘–=2âˆ¼ğ‘›ï¼Œä¾åºæ˜¯ p(i)  ğ‘(ğ‘–) èˆ‡ r(i)  ğ‘Ÿ(ğ‘–)ã€‚ n  ğ‘› ä¸è¶…é 10 5   105ï¼Œ r(i)  ğ‘Ÿ(ğ‘–) ä¸è¶…é 1000  1000 çš„æ­£æ•´æ•¸ã€‚

è¼¸å‡ºèªªæ˜

è¼¸å‡ºåƒåŠ æ´¾å°çš„æœ€å¤§æ­¡æ¨‚æŒ‡æ•¸ç¸½å’Œã€‚

ç¯„ä¾‹è¼¸å…¥ #1

4 7
1 5
2 6
3 8

ç¯„ä¾‹è¼¸å‡º #1

15

ç¯„ä¾‹è¼¸å…¥ #2

15 1
1 5
1 3
1 10
2 14
2 4
3 8
4 3
5 2
5 11
6 2
6 6
8 9
8 6
8 7

ç¯„ä¾‹è¼¸å‡º #2

66


/// collapse-code  
```cpp  
#include <bits/stdc++.h>
using namespace std;

const int N = 1e5 + 10;
vector<int> v[N];
int w[N], dp[N][2], p[N];

void dfs(int f) {
    dp[f][0] = 0;
    dp[f][1] = w[f]; // å¦‚æœé¸æ“‡é€™å€‹ç¯€é»ï¼Œæ­¡æ¨‚æŒ‡æ•¸è‡³å°‘åŒ…æ‹¬å®ƒè‡ªå·±

    for (int i : v[f]) {
        dfs(i);
        dp[f][0] += max(dp[i][0], dp[i][1]); // å¦‚æœ f ä¸è¢«é¸ï¼Œå‰‡å…¶å­ç¯€é»å¯ä»¥é¸æˆ–ä¸é¸ï¼Œå–è¼ƒå¤§å€¼
        dp[f][1] += dp[i][0]; // å¦‚æœ f è¢«é¸ï¼Œå‰‡å…¶å­ç¯€é»å¿…é ˆä¸è¢«é¸
    }
}

int main() {
    ios::sync_with_stdio(0);
    cin.tie(0);

    int n;
    cin >> n >> w[1];
    for (int i = 2; i <= n; i++) {
        int x, y;
        cin >> x >> y;
        v[x].push_back(i);
        w[i] = y;
    }

    dfs(1);

    cout << max(dp[1][0], dp[1][1]) << endl; // å¾æ ¹ç¯€é»çš„ä¸é¸å’Œé¸ä¸­é¸è¼ƒå¤§çš„ä¸€å€‹
    return 0;
}
```
///



### a144: Q\_8\_12 ä½”é ˜é€£çºŒçš„åŸé®

https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a144     
å…§å®¹          
     
æŸå€‹éŠæˆ²ä¸­æœ‰ n  ğ‘› å€‹åŸé®ä»¥ 1âˆ¼n  1âˆ¼ğ‘› ç·¨è™Ÿï¼Œé€™äº›åŸé®ä»¥ nâˆ’1  ğ‘›âˆ’1 æ¢é“è·¯é€£æ¥ï¼Œæ¯æ¢é“è·¯éƒ½æ˜¯é›™å‘é€šè¡Œä¸”é€£æ¥å…©å€‹ä¸åŒçš„åŸé®ï¼Œå·²çŸ¥å¾ä»»å…©å€‹åŸé®ä¹‹é–“éƒ½å¯ä»¥ç¶“ç”±é€™äº›é“è·¯é€šé”ã€‚          
     
ç¾åœ¨ä½ è¦ä½”é ˜ä¸€äº›åŸé®ä¾†ç²å–æœ€å¤§çš„åˆ©ç›Šï¼Œä½”é ˜ç·¨è™Ÿ i  ğ‘– çš„åŸé®å¯ä»¥ç²å¾— w i   ğ‘¤ğ‘–çš„åˆ©ç›Šï¼Œ ä½†æ˜¯ä½ ä½”é ˜çš„åŸé®å¿…é ˆå…§éƒ¨å¯ä»¥äº’ç›¸é€šé”ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œè‹¥ i  ğ‘– èˆ‡ j  ğ‘— éƒ½æ˜¯ä½ çš„é ˜åœ°ï¼Œå‰‡å¾ i       ğ‘–      å‡ºç™¼å¯ä»¥åªç¶“éä½ è‡ªå·±çš„åŸé®åˆ°é” j  ğ‘—ã€‚è«‹è¨ˆç®—ä½ æœ€å¤šå¯ä»¥ç²å¾—å¤šå°‘ç¸½å’Œåˆ©ç›Šã€‚          
     
è¼¸å…¥èªªæ˜          
     
ç¬¬ä¸€è¡Œæ˜¯æ­£æ•´æ•¸ n  ğ‘›ï¼Œn>1  ğ‘›>1ï¼Œæ‘èŠä»¥ 1âˆ¼n  1âˆ¼ğ‘› ç·¨è™Ÿã€‚          
     
ç¬¬äºŒè¡Œæœ‰ n  ğ‘› å€‹æ•´æ•¸ï¼Œä¾åºæ˜¯ w 1 ,w 2 ,â€¦,w n   ğ‘¤1,ğ‘¤2,â€¦,ğ‘¤ğ‘›ã€‚          
     
æ¥ä¸‹ä¾†æœ‰ nâˆ’1  ğ‘›âˆ’1 è¡Œæ˜¯é“è·¯çš„è³‡æ–™ï¼Œæ¯ä¸€è¡Œæœ‰å…©å€‹æ­£æ•´æ•¸ u  ğ‘¢ èˆ‡ v  ğ‘£ï¼Œ ä»£è¡¨æœ‰ä¸€æ¢é“è·¯é€£æ¥ u  ğ‘¢ èˆ‡ v  ğ‘£ã€‚          
     
n  ğ‘› ä¸è¶…é 10 5   105ï¼Œæ¯å€‹åŸé®åˆ©ç›Šçš„çµ•å°å€¼ä¸è¶…é 10 4   104ã€‚          
     
è¼¸å‡ºèªªæ˜          
     
Â æœ€å¤šå¯ä»¥ç²å¾—çš„ç¸½å’Œåˆ©ç›Šã€‚          
     
ç¯„ä¾‹è¼¸å…¥ #1          
     
5          
-2 3 -1 3 -4          
1 2          
5 1          
5 3          
5 4          
     
ç¯„ä¾‹è¼¸å‡º #1          
     
3          
     
ç¯„ä¾‹è¼¸å…¥ #2          
     
7          
2 -1 4 -3 5 -3 2          
1 2          
2 3          
4 3          
5 4          
5 6          
7 6          
     
ç¯„ä¾‹è¼¸å‡º #2          
     
7          
     
![alt text](../images/æ¨¹è«–/ryey6tF4R.png){width=100%}



/// collapse-code  
```cpp title="ç¨‹å¼ç¢¼ (GPT4ï¼Œå¦‚åœ–)"
#include <bits/stdc++.h>
using namespace std;

const int MAX_N = 100005; // å®šç¾©æœ€å¤§ç¯€é»æ•¸
vector<int> adj[MAX_N];   // ç”¨ä¾†å­˜å„²æ¨¹çš„é„°æ¥è¡¨
int w[MAX_N];             // æ¯å€‹åŸé®çš„åˆ©ç›Šå€¼
int dp[MAX_N];            // DPæ•¸çµ„ï¼Œç”¨æ–¼å­˜å„²åŒ…å«ç¯€é»içš„æœ€å¤§åˆ©ç›Š
bool visited[MAX_N];      // ç”¨æ–¼DFSä¸­æ¨™è¨˜å·²è¨ªå•çš„ç¯€é»
int ans=-INT_MIN;


// æ·±åº¦å„ªå…ˆæœç´¢(DFS)å‡½æ•¸
void dfs(int f) {
    visited[f] = true;
    dp[f] = w[f];  // é¦–å…ˆåªè€ƒæ…®ç¯€é»uè‡ªå·±çš„åˆ©ç›Š

    // éæ­·æ‰€æœ‰å­ç¯€é»ï¼ˆç›¸é„°çš„é ‚é»ï¼‰
    for (int i : adj[f]) {
        if (!visited[i]) {
            dfs(i);
            // å¦‚æœdp[i]æ˜¯æ­£çš„ï¼Œå‰‡å°‡å®ƒåŠ åˆ°ç•¶å‰ç¯€é»çš„åˆ©ç›Šä¸­
            if (dp[i] > 0) {
                dp[f] += dp[i];
            }
        }
    }
    ans=max(dp[f],ans);
}

int main() {
    //istringstream cin("5 \
-2 3 -1 3 -4 \
1 2 \
5 1 \
5 3 \
5 4");
    int n;
    cin >> n; // è¼¸å…¥åŸé®æ•¸

    for (int i = 1; i <= n; i++) {
        cin >> w[i]; // è¼¸å…¥æ¯å€‹åŸé®çš„åˆ©ç›Šå€¼
    }

    for (int i = 1; i < n; i++) {
        int u, v;
        cin >> u >> v; // è®€å…¥æ¯æ¢é“è·¯é€£æ¥çš„å…©å€‹åŸé®
        adj[u].push_back(v);
        adj[v].push_back(u);
    }

    memset(visited, 0, sizeof(visited)); // åˆå§‹åŒ–è¨ªå•æ¨™è¨˜
    dfs(1); // å¾ç¯€é»1é–‹å§‹é€²è¡ŒDFS

    cout<<ans;


    return 0;
}

```
///

/// collapse-code  
```cpp title="ç¨‹å¼ç¢¼ åŠ å…¥æ¢ä»¶"
#include <bits/stdc++.h>
using namespace std;
#define N int(1e5+10)
#define nn "\n"

vector<long long>v[N];
long long n;
long long w[N];
bool visit[N];
long long dp[N][2];
long long ans=-LONG_LONG_MIN;


//dp[i][1]=dp[i-1]+w[i];
//dp[i][0]=0;


long long dfs(long long f){
    visit[f]=true;

    dp[f][1]=w[f];
    dp[f][0]=0;

    for(long long i:v[f]){
        if(!visit[i]){
            dfs(i);
            dp[f][1]+=max(dp[i][1],dp[i][0]);
            dp[f][0]=0;
            //cout<<f<<": "<<i<< " "<< dp[i][1]<<" "<< dp[i][0]<<nn;
        }
    }
    ans=max({dp[f][1],dp[f][0],ans});
}


int main(){
    ios::sync_with_stdio(0);
    cin.tie(0);



    //istringstream cin("5 \
-2 3 -1 3 -4 \
1 2 \
5 1 \
5 3 \
5 4");
    //istringstream cin("7 \
2 -1 4 -3 5 -3 2 \
1 2 \
2 3 \
4 3 \
5 4 \
5 6 \
7 6");



    cin>>n;
    for(long long i=1;i<=n;i++){
        cin>>w[i];
    }
    for(long long i=1;i<n;i++){
        long long x,y;
        cin>>x>>y;
        v[x].push_back(y);
        v[y].push_back(x);
    }



    dfs(1);


    cout<<ans;







}

```
///


### a135: P\_8\_13 ä¸åŒæˆæœ¬çš„è³¼ç‰©ä¸­å¿ƒ (@@)
https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a135

å…§å®¹     

Â æœ‰ n  ğ‘› å€‹å°æ‘é®ä»¥ 1âˆ¼n  1âˆ¼ğ‘› ç·¨è™Ÿï¼Œé€™äº›æ‘é®ä»¥ nâˆ’1  ğ‘›âˆ’1 æ¢é“è·¯é€£æ¥ï¼Œæ¯æ¢é“è·¯éƒ½æ˜¯é›™å‘é€šè¡Œä¸”é€£æ¥å…©å€‹ä¸åŒçš„æ‘é®ï¼Œå·²çŸ¥å¾ä»»å…©å€‹æ‘èŠä¹‹é–“éƒ½å¯ä»¥ç¶“ç”±é€™äº›é“è·¯é€šé”ï¼Œå…©å€‹æ‘èŠç¨±ç‚ºé„°è¿‘çš„æ‘     èŠï¼Œå¦‚æœå®ƒå€‘ä¹‹é–“æœ‰ä¸€æ¢é“è·¯ç›´æ¥ç›¸é€£ã€‚     

ç¾åœ¨è¦é¸ä¸€äº›æ‘èŠæˆç«‹æœå‹™ä¸­å¿ƒï¼Œå› ç‚ºé ç®—çš„é—œä¿‚ç„¡æ³•æ¯å€‹æ‘èŠéƒ½æˆç«‹ä¸€å€‹æœå‹™ä¸­å¿ƒï¼Œæ”¿åºœçš„æ”¿ç­–æ±ºå®šï¼šå¦‚æœæŸå€‹æ‘èŠæ²’æœ‰è¨­æœå‹™ä¸­å¿ƒï¼Œé‚£éº¼ä»–ä¸€å®šæœ‰ä¸€å€‹é„°è¿‘çš„æ‘èŠæœ‰æœå‹™ä¸­å¿ƒã€‚ä¹Ÿå°±æ˜¯èªªï¼Œä»»ä½•ä¸€å€‹æ‘èŠ     æœ€å¤šåªè¦ç¶“éä¸€æ¢é“è·¯å°±å¯ä»¥åˆ°é”ä¸€å€‹æœ‰è¨­æœå‹™ä¸­å¿ƒçš„æ‘èŠã€‚æ¯å€‹æ‘èŠè¨­ç«‹æœå‹™ä¸­å¿ƒçš„æˆæœ¬ä¸åŒï¼Œåœ¨ç·¨è™Ÿ i  ğ‘– çš„æ‘èŠæˆç«‹æœå‹™ä¸­å¿ƒéœ€è¦çš„æˆæœ¬æ˜¯ w i   ğ‘¤ğ‘–ï¼Œæˆ‘å€‘å¸Œæœ›ä»¥æœ€å°‘çš„ç¸½æˆæœ¬è¨­ç½®æœå‹™ä¸­å¿ƒï¼Œè«‹     ä½ è¨ˆç®—æœ€å°‘çš„ç¸½æˆæœ¬ã€‚     

è¼¸å…¥èªªæ˜     

ç¬¬ä¸€è¡Œæ˜¯æ­£æ•´æ•¸ n  ğ‘›ï¼Œn>1  ğ‘›>1ï¼Œæ‘èŠä»¥ 1âˆ¼n  1âˆ¼ğ‘› ç·¨è™Ÿã€‚       
ç¬¬äºŒè¡Œæœ‰ n  ğ‘› å€‹æ­£æ•´æ•¸ï¼Œä¾åºæ˜¯ w 1 ,w 2 ,â€¦,w n   ğ‘¤1,ğ‘¤2,â€¦,ğ‘¤ğ‘›ã€‚       
æ¥ä¸‹ä¾†æœ‰ nâˆ’1  ğ‘›âˆ’1 è¡Œæ˜¯é“è·¯çš„è³‡æ–™ï¼Œæ¯ä¸€è¡Œæœ‰å…©å€‹æ­£æ•´æ•¸ u  ğ‘¢ èˆ‡ v  ğ‘£ï¼Œä»£è¡¨æœ‰ä¸€æ¢é“è·¯é€£æ¥ u  ğ‘¢ èˆ‡ v  ğ‘£ã€‚     

n  ğ‘› ä¸è¶…é 10 5   105ï¼Œæ¯å€‹æ‘èŠè¨­ç½®æˆæœ¬ä¸è¶…é 1000  1000ã€‚     

è¼¸å‡ºèªªæ˜     

æœ€å°‘éœ€è¦æˆç«‹çš„æœå‹™ä¸­å¿ƒæ•¸é‡ã€‚     

ç¯„ä¾‹è¼¸å…¥ #1     

5     
2 4 1 3 7     
1 2     
5 1     
5 3     
5 4     

ç¯„ä¾‹è¼¸å‡º #1     

6     

ç¯„ä¾‹è¼¸å…¥ #2     

7     
1 3 3 1 2 2 1     
1 2     
2 3     
4 3     
5 4     
5 6     
7 6     

ç¯„ä¾‹è¼¸å‡º #2     

3     

![alt text](../images/æ¨¹è«–/image-54.png){width=100%}



/// collapse-code  
```cpp  
// P-8-13 min domination set of a tree
// top-down DP d1(r): min cost with root,
// d01(r): without root but root is dominated
// d00(r): without root and root is not necessarily dominated
// d1(r)=w(r)+sum(min(d00(v),d1(v)): all child v of r), d00<=d01
// d00(r)=sum(min(d1(v),d01(v)))
// d01(r)=sum(min(d1(v),d01(v)))+ max(0,min(d1[v}-d01(v)))
// not all d01
#include <bits/stdc++.h>
using namespace std;
#define N 100020
#define oo 1000000000
vector<int> v[N];
int w[N], d1[N], d01[N], d00[N];

bool visit[N];

// set min domination set of subtree(r) with parent p
void dfs(int f){
    visit[f]=true;
    d1[f] = w[f], d01[f]=oo, d00[f]=0;
    for (int i: v[f]) {
        if(!visit[i]){
            dfs(i);
            d1[f] += min(d00[i], d1[i]);  //è‡ªå·±æœ‰
            d00[f] += min(d1[i], d01[i]); //å…¶ä¸€å­æœ‰
            d01[f] = min(d01[f], d1[i]-d01[i]); //æ²’æœ‰å­æœ‰
        }
    }
    d01[f] = d00[f] + max(0, d01[f]);
    return;
}
int main() {

    //istringstream cin("5 \
2 4 1 3 7 \
1 2 \
5 1 \
5 3 \
5 4");
    //istringstream cin("7 \
1 3 3 1 2 2 1 \
1 2 \
2 3 \
4 3 \
5 4 \
5 6 \
7 6");

    int i, n;
    cin>>n;
    for (i=1; i<=n; i++) cin>>w[i];
    for (i=1; i<n; i++) {
        int x,y;
        cin>>x>>y;
        v[x].push_back(y);
        v[y].push_back(x);
    }
    // parent of root(1) is set to 0(dummy);
    dfs(1);
    cout<<min(d1[1], d01[1]);
    return 0;
}

```
///


### a142: Q\_8\_16.ç—…æ¯’æ¼”åŒ– (APCS202007)
https://judge.hwsh.tc.edu.tw/ShowProblem?problemid=a142
å…§å®¹

Â åœ¨è³‡è¨Šç§‘å­¸ä¸Šï¼ŒRNA ç—…æ¯’å¯ä»¥çœ‹æˆä¸€å€‹ç”± Aã€Uã€Gã€C é€™å››ç¨®å­—æ¯æ§‹æˆçš„å­—ä¸²ã€‚ç—…æ¯’ æ¼”åŒ–ä¸­ï¼ŒæŸäº›å­—å…ƒå¯èƒ½è®Šç•°æˆå…¶ä»–å­—å…ƒï¼Œä¾‹å¦‚å°‡ AAUGG ä¸­çš„ç¬¬ 3 å€‹ä½ç½®çš„ U æ›æˆ Cï¼Œ å‰‡å¾—åˆ° AACGGï¼Œè®Šç•°å¯èƒ½ç™¼ç”Ÿåœ¨å¤šå€‹ä½ç½®ã€‚æœ‰å€‹å¯¦é©—åœ˜éšŠå–å¾—äº†æŸç¨® RNA ç—…æ¯’çš„æ•¸ å€‹ RNA ç‰‡æ®µæ¨£æœ¬ï¼Œä¸¦ä¸”æŒæ¡åˆ°é€™äº›æ¨£æœ¬æ¼”åŒ–çš„è¦ªç·£é—œä¿‚ï¼Œç”¨  
ï¼ˆæ¨£æœ¬ç·¨è™Ÿï¼Œè¦ªä»£ç·¨è™Ÿï¼ŒRNA å­—ä¸²ï¼‰  
çš„æ ¼å¼è¨˜éŒ„ï¼Œå…¶ä¸­ã€Œæ¨£æœ¬ç·¨è™Ÿã€èˆ‡ã€Œè¦ªä»£ç·¨è™Ÿã€ç‚ºå…©å€‹æ•´æ•¸ï¼Œè‹¥å…©æ•¸å­—ç›¸åŒï¼Œå‰‡è©²æ¨£ æœ¬å³ç‚ºæ¼”åŒ–çš„æºé ­ã€‚ä¾‹å¦‚ï¼Œ  
ï¼ˆ1, 1, AAAAï¼‰ï¼ˆ2, 1, GCAAï¼‰  
è¡¨ç¤ºæ¨£æœ¬ 1 çš„ RNA å­—ä¸²ç‚º AAAAï¼Œæ¨£æœ¬ 2 çš„ç‚º GCAAï¼Œä¸”æ¨£æœ¬ 2 æ˜¯ç”±æ¨£æœ¬ 1 åœ¨å…©å€‹ä½ç½®ç™¼ç”Ÿè®Šç•°æ¼”åŒ–è€Œä¾†ï¼Œæ¨£æœ¬ 1 ç‚ºæ¼”åŒ–çš„æºé ­ã€‚

ç„¶è€Œï¼Œå­—ä¸²ä¸­æ¯å€‹ä½ç½®çš„å­—å…ƒç„¡æ³•ç¢ºå®šï¼Œå¯¦é©—åœ˜éšŠä»¥@ä¾†è¡¨ç¤ºé€™äº›å­—å…ƒï¼Œæ›è¨€ä¹‹ï¼Œ@å¯èƒ½ç‚º Aã€Uã€Gã€C ä¸­ä»»ä½•ä¸€å€‹ã€‚è«‹æ³¨æ„ï¼Œä¸€å€‹å­—ä¸²ä¸­å¯èƒ½æœ‰å¤šå€‹@ï¼Œä¸¦éä»£è¡¨é€™äº›ä½ ç½®çš„å­—å…ƒæ˜¯ç›¸åŒçš„ã€‚ä¾‹å¦‚ A@C@å¯èƒ½æ˜¯ä»»ä½•ç¬¬ä¸€å€‹å­—å…ƒç‚º A ä¸”ç¬¬ä¸‰å€‹å­—å…ƒç‚º C çš„å­—ä¸²ï¼Œåƒæ˜¯ ACCU æˆ– AACCã€‚åœ˜éšŠçŒœæ¸¬æ¼”åŒ–éç¨‹ç™¼ç”Ÿçš„è®Šç•°ç¸½æ•¸æœƒç›¡å¯èƒ½çš„å°‘ã€‚è«‹ä½ åˆ© ç”¨è¦ªç·£é—œä¿‚ï¼Œä¾†è¨ˆç®—æœ€å°çš„è®Šç•°ç¸½æ•¸é‡ã€‚

è¼¸å…¥èªªæ˜

Â ç¬¬ä¸€è¡Œæœ‰å…©å€‹æ­£æ•´æ•¸ n èˆ‡ mï¼Œè¡¨ç¤ºå…±æœ‰ n å€‹æ¨£æœ¬ï¼Œç”± 1 è‡³ n ç·¨è™Ÿï¼›æ¯ å€‹æ¨£æœ¬ä¹‹ RNA å­—ä¸²é•·åº¦å‡ç‚º mï¼Œå…¶ä¸­ n â‰¤ 1000 ä¸” mÂ â‰¤ 80ã€‚

æ¥ä¸‹ä¾† n è¡Œï¼Œæ¯è¡ŒåŒ…å«ä»¥ç©ºç™½é–“éš”çš„å…©å€‹æ­£æ•´æ•¸ i èˆ‡ j ä»¥åŠä¸€å€‹ RNA å­—ä¸² siï¼Œå°æ‡‰ä¸€å€‹æ¨£æœ¬ï¼ˆi, j, siï¼‰ï¼Œsiç”± Aã€Uã€Gã€C èˆ‡@äº”ç¨®å­—å…ƒæ‰€çµ„æˆã€‚è‹¥ i=j=1ï¼Œå‰‡è©²æ¨£æœ¬å³ç‚ºæ¼”åŒ–çš„æºé ­ï¼Œ æºé ­ä»¥å¤–çš„æ¨£æœ¬çš†æ°æœ‰ä¸€å€‹è¦ªä»£ã€‚

è¼¸å‡ºèªªæ˜

Â è¼¸å‡ºæœ€å°å¯èƒ½çš„è®Šç•°ç¸½æ•¸ã€‚

ç¯„ä¾‹è¼¸å…¥ #1     
     
2 3     
1 1 AAC     
2 1 A@@     
     
ç¯„ä¾‹è¼¸å‡º #1     
     
0     
     
ç¯„ä¾‹è¼¸å…¥ #2     
     
6 1     
1 1 @     
2 1 @     
3 1 C     
4 1 C     
5 2 A     
6 2 A     
     
ç¯„ä¾‹è¼¸å‡º #2     
     
1     
     

/// collapse-code  
```cpp  
{% raw %}
```cpp
#include <iostream>
#include <vector>
#include <map>
using namespace std;
 
int n, m, root, dp[1005][85][5], ans, inf = 1e9;
string s[1005];
vector <int> v[1005];
map <char, int> mp = {{'@', 0}, {'A', 1}, {'U', 2}, {'C', 3}, {'G', 4}};
 
void f(int now, int pos){
    if (v[now].empty()){
        if (s[now][pos] == '@') return;
        for (int i = 0; i <= 4; i++){
            dp[now][pos][i] = inf;
        }
        dp[now][pos][0] = dp[now][pos][mp[s[now][pos]]] = 0;
        return;
    }
    for (auto i:v[now]){
        f(i, pos);
    }
    int c = mp[s[now][pos]];
    if (c != 0){
        for (int i = 0; i <= 4; i++){
            dp[now][pos][i] = inf;
        }
        dp[now][pos][c] = 0;
        for (auto i:v[now]){
            dp[now][pos][c] += min(dp[i][pos][0]+1, dp[i][pos][c]);
        }
        dp[now][pos][0] = dp[now][pos][c];
        return;
    }
    for (c = 1; c <= 4; c++){
        for (auto i:v[now]){
            dp[now][pos][c] += min(dp[i][pos][0]+1, dp[i][pos][c]);
        }
    }
    dp[now][pos][0] = min(min(dp[now][pos][1], dp[now][pos][2]), min(dp[now][pos][3], dp[now][pos][4]));
}
 
int main() {
    cin >> n >> m;
    for (int i = 0, a, b; i < n; i++){
        cin >> a >> b;
        cin >> s[a];
        if (a == b) root = a;
        else v[b].push_back(a);
    }
    for (int i = 0; i < m; i++){
        f(root, i);
        ans += dp[root][i][0];
    }
    cout << ans << "\n";
}
```
{% endraw %}
///




### 	[2171 . æ‰“å¡éŠæˆ² (Checkin)](https://tioj.ck.tp.edu.tw/problems/2171)


/// collapse-code  
```cpp  
#include<bits/stdc++.h>
using namespace std;
#define nn "\n"
#define nnn " "
#define N 2000
// #define int long long

int n,m,x,y,z,k;
vector<int>v[N];
bool vis[N];
int odd=0;

void dfs(int f){
    vis[f]=true;
    if(v[f].size()&1){
        odd++;
    }
    for(int i:v[f]){
        if(!vis[i]){
            dfs(i);
        }
    }
}
signed main(){
    ios::sync_with_stdio(0);
    cin.tie(0);
    //istringstream cin("3 3 100 20 5 \
1 1 5 \
1 2 4 \
3 3 8 \
2 1 4 \
2 2 4");
    cin>>n>>m>>x>>x>>k;
    for(int i=0;i<k;i++){
        cin>>x>>y>>z;
        v[x].push_back(y+n);
        v[y+n].push_back(x);
    }
    int ans=0;
    for(int i=1;i<=n+m;i++){
        if(!vis[i] && v[i].size()){
            odd=0;
            dfs(i);
            ans+=max( odd/2 , 1);
        }
    }
    cout<<ans;
}
```
///


